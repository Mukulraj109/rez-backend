
> user-backend@1.0.0 test
> jest

  console.warn
    Starting the MongoMemoryServer Instance failed, enable debug log for more information. Error:
     UnableToUnlockLockfileError: Cannot unlock file "C:\Users\Mukul raj\.cache\mongodb-binaries\7.0.14.lock", because it is not locked by this process
        at LockFile.unlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\lockfile.ts:275:15)
        at Function.download (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoBinary.ts:52:7)
        at Function.getPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoBinary.ts:132:22)
        at MongoInstance.start (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:366:22)
        at Function.create (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:294:5)
        at MongoMemoryServer._startUpInstance (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\MongoMemoryServer.ts:530:22)
        at MongoMemoryServer.start (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\MongoMemoryServer.ts:350:5)
        at Function.create (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\MongoMemoryServer.ts:317:5)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\setup.ts:9:19) {
      thisInstance: false,
      file: 'C:\\Users\\Mukul raj\\.cache\\mongodb-binaries\\7.0.14.lock'
    }

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:359:17
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  console.error
    ‚ùå Test database connection failed: UnableToUnlockLockfileError: Cannot unlock file "C:\Users\Mukul raj\.cache\mongodb-binaries\7.0.14.lock", because it is not locked by this process
        at LockFile.unlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\lockfile.ts:275:15)
        at Function.download (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoBinary.ts:52:7)
        at Function.getPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoBinary.ts:132:22)
        at MongoInstance.start (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:366:22)
        at Function.create (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:294:5)
        at MongoMemoryServer._startUpInstance (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\MongoMemoryServer.ts:530:22)
        at MongoMemoryServer.start (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\MongoMemoryServer.ts:350:5)
        at Function.create (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\MongoMemoryServer.ts:317:5)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\setup.ts:9:19) {
      thisInstance: false,
      file: 'C:\\Users\\Mukul raj\\.cache\\mongodb-binaries\\7.0.14.lock'
    }

    [0m [90m 13 |[39m     console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 14 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 15 |[39m     console[33m.[39merror([32m'‚ùå Test database connection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 16 |[39m     [36mthrow[39m error[33m;[39m
     [90m 17 |[39m   }
     [90m 18 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:15:13)

(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"phoneNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"referral.referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"profile.location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"username":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18372) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ Partner Service Tests Completed

      at Object.<anonymous> (src/__tests__/partnerService.test.ts:488:9)

(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"phoneNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"referral.referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"profile.location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"username":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:39464) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18964) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:18964) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18964) [MONGOOSE] Warning: Duplicate schema index on {"sku":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"phoneNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"referral.referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"profile.location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"username":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.warn
    Starting the MongoMemoryServer Instance failed, enable debug log for more information. Error:
     GenericMMSError: Instance failed to start within 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:383:21)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:359:17
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  console.error
    ‚ùå Test database connection failed: GenericMMSError: Instance failed to start within 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:383:21)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 13 |[39m     console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 14 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 15 |[39m     console[33m.[39merror([32m'‚ùå Test database connection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 16 |[39m     [36mthrow[39m error[33m;[39m
     [90m 17 |[39m   }
     [90m 18 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:15:13)

  console.warn
    Starting the MongoMemoryServer Instance failed, enable debug log for more information. Error:
     GenericMMSError: Instance failed to start within 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:383:21)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:359:17
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test database connection failed: GenericMMSError: Instance failed to start within 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:383:21)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 13 |[39m     console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 14 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 15 |[39m     console[33m.[39merror([32m'‚ùå Test database connection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 16 |[39m     [36mthrow[39m error[33m;[39m
     [90m 17 |[39m   }
     [90m 18 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:15:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\orders.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/orders.test.ts:6:26)

(node:29544) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\team.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/team.test.ts:6:26)

(node:3428) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
  console.warn
    Starting the MongoMemoryServer Instance failed, enable debug log for more information. Error:
     GenericMMSError: Instance failed to start within 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:383:21)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:359:17
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  console.error
    ‚ùå Test database connection failed: GenericMMSError: Instance failed to start within 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongodb-memory-server-core\src\util\MongoInstance.ts:383:21)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 13 |[39m     console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 14 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 15 |[39m     console[33m.[39merror([32m'‚ùå Test database connection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 16 |[39m     [36mthrow[39m error[33m;[39m
     [90m 17 |[39m   }
     [90m 18 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:15:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ [REFERRAL] Created referral relationship: 865c61 -> 865c62

      at ReferralService.createReferral (src/services/referralService.ts:93:13)

  console.log
    ‚úÖ [REFERRAL] Created referral relationship: 865c61 -> 865c62

      at console.<anonymous> (node_modules/jest-mock/build/index.js:631:25)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\onboarding.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/onboarding.test.ts:6:26)

(node:1612) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

FAIL src/__tests__/referralService.test.ts (54.927 s)
  Referral Service
    createReferral
      ‚àö should create a new referral relationship (107 ms)
      ‚àö should throw error if referral already exists (41 ms)
    getReferralStats
      ‚àö should calculate correct referral statistics (6 ms)
      ‚àö should return zero stats for user with no referrals (2 ms)
    validateReferralCode
      ‚àö should validate correct referral code (20 ms)
      ‚àö should reject invalid referral code (2 ms)
    processFirstOrder
      √ó should credit referrer on referee first order (7 ms)
      √ó should mark referral as completed when both rewarded (3 ms)
    Security and Data Privacy
      ‚àö should not log PII in referral creation (44 ms)

  ‚óè Referral Service ‚Ä∫ processFirstOrder ‚Ä∫ should credit referrer on referee first order

    TypeError: Cannot read properties of undefined (reading 'reduce')

    [0m [90m 259 |[39m     [36mconst[39m referrals [33m=[39m [36mawait[39m [33mReferral[39m[33m.[39mfind({ referrer[33m:[39m userId })[33m;[39m
     [90m 260 |[39m
    [31m[1m>[22m[39m[90m 261 |[39m     [36mconst[39m stats [33m=[39m referrals[33m.[39mreduce(
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 262 |[39m       (acc[33m,[39m ref) [33m=>[39m {
     [90m 263 |[39m         acc[33m.[39mtotalReferrals[33m++[39m[33m;[39m
     [90m 264 |[39m         [36mconst[39m rewards [33m=[39m ref[33m.[39mrewards [36mas[39m any[33m;[39m[0m

      at ReferralService.getReferralStats (src/services/referralService.ts:261:29)
      at ReferralService.updateUserReferralStats (src/services/referralService.ts:368:19)
      at ReferralService.processFirstOrder (src/services/referralService.ts:177:5)
      at Object.<anonymous> (src/__tests__/referralService.test.ts:190:7)

  ‚óè Referral Service ‚Ä∫ processFirstOrder ‚Ä∫ should mark referral as completed when both rewarded

    TypeError: Cannot read properties of undefined (reading 'reduce')

    [0m [90m 259 |[39m     [36mconst[39m referrals [33m=[39m [36mawait[39m [33mReferral[39m[33m.[39mfind({ referrer[33m:[39m userId })[33m;[39m
     [90m 260 |[39m
    [31m[1m>[22m[39m[90m 261 |[39m     [36mconst[39m stats [33m=[39m referrals[33m.[39mreduce(
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 262 |[39m       (acc[33m,[39m ref) [33m=>[39m {
     [90m 263 |[39m         acc[33m.[39mtotalReferrals[33m++[39m[33m;[39m
     [90m 264 |[39m         [36mconst[39m rewards [33m=[39m ref[33m.[39mrewards [36mas[39m any[33m;[39m[0m

      at ReferralService.getReferralStats (src/services/referralService.ts:261:29)
      at ReferralService.updateUserReferralStats (src/services/referralService.ts:368:19)
      at ReferralService.processFirstOrder (src/services/referralService.ts:177:5)
      at Object.<anonymous> (src/__tests__/referralService.test.ts:231:7)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\PredictiveAnalyticsService.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/PredictiveAnalyticsService.test.ts:6:26)

(node:18964) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\PredictiveAnalyticsService.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/PredictiveAnalyticsService.test.ts:6:26)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

PASS src/__tests__/routes/onboarding.test.ts (55.861 s)
  Onboarding Routes
    GET /api/merchant/onboarding/status
      ‚àö should get onboarding status (589 ms)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

FAIL src/__tests__/services/PredictiveAnalyticsService.test.ts (56.834 s)
  PredictiveAnalyticsService
    forecastSales
      √ó should forecast sales for next period (1165 ms)
    predictStockout
      √ó should predict potential stockouts (402 ms)

  ‚óè PredictiveAnalyticsService ‚Ä∫ forecastSales ‚Ä∫ should forecast sales for next period

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 15 |[39m       )[33m;[39m
     [90m 16 |[39m       expect(forecast)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 17 |[39m       expect([33mArray[39m[33m.[39misArray(forecast))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 18 |[39m     })[33m;[39m
     [90m 19 |[39m   })[33m;[39m
     [90m 20 |[39m[0m

      at Object.<anonymous> (src/__tests__/services/PredictiveAnalyticsService.test.ts:17:39)

  ‚óè PredictiveAnalyticsService ‚Ä∫ predictStockout ‚Ä∫ should predict potential stockouts

    Product not found

    [0m [90m 193 |[39m     [36mconst[39m product [33m=[39m [36mawait[39m [33mProduct[39m[33m.[39mfindById(productId)[33m.[39mlean() [36mas[39m any[33m;[39m
     [90m 194 |[39m     [36mif[39m ([33m![39mproduct) {
    [31m[1m>[22m[39m[90m 195 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Product not found'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 196 |[39m     }
     [90m 197 |[39m
     [90m 198 |[39m     [90m// Get sales data for last 30 days[39m[0m

      at Function.predictStockout (src/merchantservices/PredictiveAnalyticsService.ts:195:13)
      at Object.<anonymous> (src/__tests__/services/PredictiveAnalyticsService.test.ts:24:27)

(node:23064) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:23064) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:23064) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:23064) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/partnerService.test.ts:29:11)

FAIL src/__tests__/partnerService.test.ts (57.297 s)
  Partner Service - Core Functionality
    getOrCreatePartner
      √ó should create a new partner profile for first-time user (26 ms)
      √ó should return existing partner if already created (14 ms)
      √ó should throw error if user not found (13 ms)
    claimMilestoneReward - MongoDB Transactions
      √ó should claim milestone reward and credit wallet atomically (14 ms)
      √ó should rollback if wallet creation fails (18 ms)
      √ó should prevent claiming same milestone twice (14 ms)
      √ó should throw error if milestone not achieved yet (15 ms)
    claimTaskReward - MongoDB Transactions
      √ó should claim task reward with atomic transaction (15 ms)
      √ó should prevent claiming incomplete task (16 ms)
    claimJackpotReward - MongoDB Transactions
      √ó should claim jackpot reward with atomic transaction (14 ms)
      √ó should throw error for invalid jackpot amount (13 ms)
    Level System - Timeframe Validation
      √ó should NOT allow upgrade if timeframe expired (12 ms)
      √ó should allow upgrade if both orders and timeframe requirements met (13 ms)
    Level Expiry Handling
      √ó should reset progress if level expired without reaching next level (12 ms)
      √ó should auto-upgrade if level expired with requirements met (13 ms)
  Partner Service - Input Validation
    √ó should validate milestone ID format (12 ms)
    √ó should validate jackpot amounts (13 ms)
    √ó should validate task types (12 ms)

  ‚óè Partner Service - Core Functionality ‚Ä∫ getOrCreatePartner ‚Ä∫ should create a new partner profile for first-time user

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ getOrCreatePartner ‚Ä∫ should return existing partner if already created

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ getOrCreatePartner ‚Ä∫ should throw error if user not found

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimMilestoneReward - MongoDB Transactions ‚Ä∫ should claim milestone reward and credit wallet atomically

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimMilestoneReward - MongoDB Transactions ‚Ä∫ should rollback if wallet creation fails

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimMilestoneReward - MongoDB Transactions ‚Ä∫ should prevent claiming same milestone twice

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimMilestoneReward - MongoDB Transactions ‚Ä∫ should throw error if milestone not achieved yet

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimTaskReward - MongoDB Transactions ‚Ä∫ should claim task reward with atomic transaction

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimTaskReward - MongoDB Transactions ‚Ä∫ should prevent claiming incomplete task

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimJackpotReward - MongoDB Transactions ‚Ä∫ should claim jackpot reward with atomic transaction

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ claimJackpotReward - MongoDB Transactions ‚Ä∫ should throw error for invalid jackpot amount

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ Level System - Timeframe Validation ‚Ä∫ should NOT allow upgrade if timeframe expired

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ Level System - Timeframe Validation ‚Ä∫ should allow upgrade if both orders and timeframe requirements met

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ Level Expiry Handling ‚Ä∫ should reset progress if level expired without reaching next level

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Core Functionality ‚Ä∫ Level Expiry Handling ‚Ä∫ should auto-upgrade if level expired with requirements met

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Input Validation ‚Ä∫ should validate milestone ID format

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Input Validation ‚Ä∫ should validate jackpot amounts

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  ‚óè Partner Service - Input Validation ‚Ä∫ should validate task types

    MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections

    [0m [90m 19 |[39m   [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 20 |[39m   
    [31m[1m>[22m[39m[90m 21 |[39m   [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m
     [90m    |[39m                  [31m[1m^[22m[39m
     [90m 22 |[39m   console[33m.[39mlog([32m'‚úÖ Test database connected'[39m)[33m;[39m
     [90m 23 |[39m })[33m;[39m
     [90m 24 |[39m[0m

      at NativeConnection.createClient (node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:251:13)
      at NativeConnection.openUri (node_modules/mongoose/lib/connection.js:1071:34)
      at Mongoose.connect (node_modules/mongoose/lib/mongoose.js:450:15)
      at Object.<anonymous> (src/__tests__/partnerService.test.ts:21:18)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\products.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/products.test.ts:6:26)

(node:33772) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    
    ‚úÖ Diversity Service Test Suite Complete

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:508:9)

  console.log
    üìä Test Coverage:

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:509:9)

  console.log
       - Category balancing

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:510:9)

  console.log
       - Brand balancing

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:511:9)

  console.log
       - Price range balancing

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:512:9)

  console.log
       - Diversity score calculation

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:513:9)

  console.log
       - Diversity mode application

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:514:9)

  console.log
       - Metadata generation

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:515:9)

  console.log
       - Edge cases

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:516:9)

  console.log
       - Performance tests

      at Object.<anonymous> (src/__tests__/diversityService.test.ts:517:9)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\e2e\merchant-journey.e2e.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:891:7)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/e2e/merchant-journey.e2e.test.ts:6:26)

(node:1612) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

PASS src/__tests__/routes/products.test.ts
  Product Routes
    ‚àö placeholder test (274 ms)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

PASS src/__tests__/e2e/merchant-journey.e2e.test.ts
  E2E: Complete Merchant Journey
    ‚àö placeholder test (34 ms)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\auth.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/auth.test.ts:6:26)

(node:18964) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 5 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 4

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 2

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 0 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 0

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 0

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 3 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 3

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 2

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 3 Max per category: 1

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 2

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 2

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 5 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 4

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 2

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 3 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 3

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 2

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 3 Max per brand: 1

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 2

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 2

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

PASS src/__tests__/routes/auth.test.ts
  Auth Routes
    ‚àö placeholder test (303 ms)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 6 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 100 - 1100

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    üìä [DIVERSITY] Price buckets: [ 2, 2, 2 ]

      at balanceByPriceRange (src/services/diversityService.ts:263:11)

  console.log
    ‚úÖ [DIVERSITY] Price balance complete. Output: 6

      at balanceByPriceRange (src/services/diversityService.ts:285:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 3 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 500 - 500

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    ‚ö†Ô∏è [DIVERSITY] All products have same price

      at balanceByPriceRange (src/services/diversityService.ts:238:13)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 3 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 100 - 500

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    üìä [DIVERSITY] Price buckets: [ 2, 0, 1 ]

      at balanceByPriceRange (src/services/diversityService.ts:263:11)

  console.log
    ‚úÖ [DIVERSITY] Price balance complete. Output: 3

      at balanceByPriceRange (src/services/diversityService.ts:285:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 2 Ranges: 2

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 100 - 500

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    üìä [DIVERSITY] Price buckets: [ 1, 1 ]

      at balanceByPriceRange (src/services/diversityService.ts:263:11)

  console.log
    ‚úÖ [DIVERSITY] Price balance complete. Output: 2

      at balanceByPriceRange (src/services/diversityService.ts:285:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 0 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 1 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 3 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 3,
      brands: 3,
      priceRanges: 3,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '1.000',
      finalScore: '1.000'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 3 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 1,
      brands: 1,
      priceRanges: 3,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '1.000',
      finalScore: '1.000'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 3 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 3,
      brands: 3,
      priceRanges: 0,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '0.000',
      finalScore: '0.700'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 6

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: { maxPerCategory: 2, maxPerBrand: 2, priceRanges: 3 }

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 6 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 6 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 5

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 3

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 5 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 5

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 3

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 5 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 100 - 1000

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    üìä [DIVERSITY] Price buckets: [ 2, 2, 1 ]

      at balanceByPriceRange (src/services/diversityService.ts:263:11)

  console.log
    ‚úÖ [DIVERSITY] Price balance complete. Output: 5

      at balanceByPriceRange (src/services/diversityService.ts:285:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 5 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 3,
      brands: 3,
      priceRanges: 3,
      categoryGini: '0.133',
      brandGini: '0.133',
      priceRangeScore: '1.000',
      finalScore: '0.907'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 5 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 0.907

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 5 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 3,
      brands: 3,
      priceRanges: 3,
      categoryGini: '0.133',
      brandGini: '0.133',
      priceRangeScore: '1.000',
      finalScore: '0.907'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: category_diverse

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 5

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: { maxPerCategory: 2, maxPerBrand: 2 }

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 5 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 5 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 5

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 3

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 5 Max per brand: 4

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 5

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 3

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 5 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 3,
      brands: 3,
      priceRanges: 0,
      categoryGini: '0.133',
      brandGini: '0.133',
      priceRangeScore: '0.000',
      finalScore: '0.607'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: category_diverse

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 5 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 0.607

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: price_diverse

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 5

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: { priceRanges: 3 }

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 5 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 5 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 100 - 1000

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    üìä [DIVERSITY] Price buckets: [ 2, 2, 1 ]

      at balanceByPriceRange (src/services/diversityService.ts:263:11)

  console.log
    ‚úÖ [DIVERSITY] Price balance complete. Output: 5

      at balanceByPriceRange (src/services/diversityService.ts:285:11)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 5 Max per category: 4

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 4

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 1

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 4 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 1,
      brands: 1,
      priceRanges: 3,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '1.000',
      finalScore: '1.000'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: price_diverse

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 4 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 1

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 4

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: { minRating: 3 }

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 2 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 2 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 2

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 1

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 2 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 2

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 1

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 2 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 1000 - 1000

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    ‚ö†Ô∏è [DIVERSITY] All products have same price

      at balanceByPriceRange (src/services/diversityService.ts:238:13)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 2 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 1,
      brands: 1,
      priceRanges: 0,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '0.000',
      finalScore: '0.700'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 2 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 0.7

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 0

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: {}

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚ö†Ô∏è [DIVERSITY] No products to diversify

      at applyDiversityMode (src/services/diversityService.ts:441:13)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 3 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 3,
      brands: 3,
      priceRanges: 3,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '1.000',
      finalScore: '1.000'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 2 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 2,
      brands: 2,
      priceRanges: 0,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '0.000',
      finalScore: '0.700'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 2

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: {}

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 2 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 2 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 2

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 2

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 2 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 2

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 2

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 2 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 1000 - 1000

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    ‚ö†Ô∏è [DIVERSITY] All products have same price

      at balanceByPriceRange (src/services/diversityService.ts:238:13)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 2 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 2,
      brands: 2,
      priceRanges: 0,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '0.000',
      finalScore: '0.700'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 2 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 0.7

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 1000

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: { maxPerCategory: 2, maxPerBrand: 2 }

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 1000 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 1000 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 20

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 10

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 20 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 20

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 20

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 20 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 100 - 290

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    üìä [DIVERSITY] Price buckets: [ 7, 6, 7 ]

      at balanceByPriceRange (src/services/diversityService.ts:263:11)

  console.log
    ‚úÖ [DIVERSITY] Price balance complete. Output: 20

      at balanceByPriceRange (src/services/diversityService.ts:285:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 20 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 10,
      brands: 20,
      priceRanges: 3,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '1.000',
      finalScore: '1.000'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 20 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 1

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üé® [DIVERSITY] Applying diversity mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:436:11)

  console.log
    üì¶ [DIVERSITY] Input products: 3

      at applyDiversityMode (src/services/diversityService.ts:437:11)

  console.log
    ‚öôÔ∏è [DIVERSITY] Options: { maxPerCategory: 2 }

      at applyDiversityMode (src/services/diversityService.ts:438:11)

  console.log
    ‚≠ê [DIVERSITY] Filtered by rating ‚â• 3 : 3 remaining

      at applyDiversityMode (src/services/diversityService.ts:460:13)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 3 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 2

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 1

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    üé® [DIVERSITY] Balancing by brand. Input: 2 Max per brand: 2

      at balanceByBrand (src/services/diversityService.ts:181:11)

  console.log
    ‚úÖ [DIVERSITY] Brand balance complete. Output: 2

      at balanceByBrand (src/services/diversityService.ts:196:11)

  console.log
    üìä [DIVERSITY] Brands represented: 1

      at balanceByBrand (src/services/diversityService.ts:197:11)

  console.log
    üé® [DIVERSITY] Balancing by price range. Input: 2 Ranges: 3

      at balanceByPriceRange (src/services/diversityService.ts:222:11)

  console.log
    üí∞ [DIVERSITY] Price range: 1000 - 1000

      at balanceByPriceRange (src/services/diversityService.ts:234:11)

  console.log
    ‚ö†Ô∏è [DIVERSITY] All products have same price

      at balanceByPriceRange (src/services/diversityService.ts:238:13)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 2 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 1,
      brands: 1,
      priceRanges: 0,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '0.000',
      finalScore: '0.700'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    ‚úÖ [DIVERSITY] Applied mode: balanced

      at applyDiversityMode (src/services/diversityService.ts:492:11)

  console.log
    üìä [DIVERSITY] Output: 2 products

      at applyDiversityMode (src/services/diversityService.ts:493:11)

  console.log
    üéØ [DIVERSITY] Score: 0.7

      at applyDiversityMode (src/services/diversityService.ts:494:11)

  console.log
    üìä [DIVERSITY] Calculating diversity score for 500 products

      at calculateDiversityScore (src/services/diversityService.ts:308:11)

  console.log
    üìà [DIVERSITY] Score breakdown: {
      categories: 10,
      brands: 20,
      priceRanges: 0,
      categoryGini: '0.000',
      brandGini: '0.000',
      priceRangeScore: '0.000',
      finalScore: '0.700'
    }

      at calculateDiversityScore (src/services/diversityService.ts:371:11)

  console.log
    üé® [DIVERSITY] Balancing by category. Input: 1000 Max per category: 2

      at balanceByCategory (src/services/diversityService.ts:141:11)

  console.log
    ‚úÖ [DIVERSITY] Category balance complete. Output: 20

      at balanceByCategory (src/services/diversityService.ts:156:11)

  console.log
    üìä [DIVERSITY] Categories represented: 10

      at balanceByCategory (src/services/diversityService.ts:157:11)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

PASS src/__tests__/diversityService.test.ts
  Diversity Service - Category Balancing
    ‚àö should limit products per category (25 ms)
    ‚àö should handle empty product array (9 ms)
    ‚àö should handle products with missing category (13 ms)
    ‚àö should handle complex category objects (11 ms)
  Diversity Service - Brand Balancing
    ‚àö should limit products per brand (12 ms)
    ‚àö should handle products with missing brand (10 ms)
    ‚àö should use store name as fallback for brand (9 ms)
  Diversity Service - Price Range Balancing
    ‚àö should stratify products by price (23 ms)
    ‚àö should handle all products with same price (10 ms)
    ‚àö should handle products with zero price (12 ms)
    ‚àö should handle different pricing schemas (9 ms)
  Diversity Service - Diversity Score Calculation
    ‚àö should return 0 for empty array (4 ms)
    ‚àö should return 1 for single product (11 ms)
    ‚àö should score diverse products higher (15 ms)
    ‚àö should return score between 0 and 1 (7 ms)
  Diversity Service - Apply Diversity Mode
    ‚àö balanced mode should apply all balancing algorithms (45 ms)
    ‚àö category_diverse mode should prioritize category diversity (50 ms)
    ‚àö price_diverse mode should prioritize price diversity (57 ms)
    ‚àö should filter by minimum rating (55 ms)
    ‚àö should handle empty product array (11 ms)
  Diversity Service - Metadata Generation
    ‚àö should generate correct metadata (11 ms)
    ‚àö should handle products with missing data (9 ms)
  Diversity Service - Edge Cases
    ‚àö should handle products with null/undefined values (46 ms)
    ‚àö should handle very large product arrays (55 ms)
    ‚àö should handle products with identical attributes (55 ms)
  Diversity Service - Performance
    ‚àö calculateDiversityScore should be fast for large arrays (8 ms)
    ‚àö balanceByCategory should be fast for large arrays (11 ms)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\team.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/team.test.ts:6:26)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\orders.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/orders.test.ts:6:26)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\analytics.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/analytics.test.ts:6:26)

(node:19656) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\analytics.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/analytics.test.ts:6:26)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

PASS src/__tests__/routes/analytics.test.ts (65.948 s)
  Analytics Routes
    GET /api/merchant/analytics/sales/overview
      ‚àö should get sales overview (748 ms)
    GET /api/merchant/analytics/forecast/sales
      ‚àö should get sales forecast (269 ms)

  console.log
    [dotenv@17.2.1] injecting env (75) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\routes\team.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/routes/team.test.ts:6:26)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test database disconnection failed: TypeError: Cannot read properties of undefined (reading 'stop')
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\setup.ts:36:23)

    [0m [90m 37 |[39m     console[33m.[39mlog([32m'‚úÖ Test database disconnected'[39m)[33m;[39m
     [90m 38 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 39 |[39m     console[33m.[39merror([32m'‚ùå Test database disconnection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 40 |[39m   }
     [90m 41 |[39m })[33m;[39m
     [90m 42 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:39:13)

  console.log
    [dotenv@17.2.1] injecting env (75) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:139:11)

FAIL src/__tests__/routes/orders.test.ts (73.193 s)
  Order Routes
    GET /api/merchant/orders
      √ó should get all orders for merchant (10259 ms)
    PUT /api/merchant/orders/:id/status
      √ó should update order status (10357 ms)

  ‚óè Order Routes ‚Ä∫ GET /api/merchant/orders ‚Ä∫ should get all orders for merchant

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Order Routes ‚Ä∫ PUT /api/merchant/orders/:id/status ‚Ä∫ should update order status

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  console.log
    ‚úÖ Twilio SMS client initialized

      at new PushNotificationService (src/services/pushNotificationService.ts:43:17)

FAIL src/__tests__/services/AnalyticsService.test.ts
  ‚óè Test suite failed to run

    [96msrc/__tests__/services/AnalyticsService.test.ts[0m:[93m12[0m:[93m47[0m - [91merror[0m[90m TS2554: [0mExpected 3 arguments, but got 1.

    [7m12[0m       const overview = await AnalyticsService.getSalesOverview(merchant._id.toString());
    [7m  [0m [91m                                              ~~~~~~~~~~~~~~~~[0m

      [96msrc/merchantservices/AnalyticsService.ts[0m:[93m97[0m:[93m5[0m
        [7m97[0m     startDate: Date,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~[0m
        An argument for 'startDate' was not provided.

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    üîç Twilio Debug: {
      accountSid: 'ACcfacaa...',
      authToken: '658a6993...',
      phoneNumber: '8210224305'
    }

      at Object.<anonymous> (src/controllers/authController.ts:34:9)

  console.log
    üîç Twilio configuration: {
      hasAccountSid: true,
      hasAuthToken: true,
      phoneNumber: '+918210224305',
      isDevelopment: false
    }

      at Object.<anonymous> (src/controllers/authController.ts:47:9)

  console.log
    ‚úÖ Twilio client initialized successfully

      at Object.<anonymous> (src/controllers/authController.ts:59:13)

  console.log
    ‚úÖ Twilio SMS client initialized

      at new PushNotificationService (src/services/pushNotificationService.ts:43:17)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚òÅÔ∏è  [CLOUDINARY] Configuration loaded: {
      cloud_name: 'dsuakj68p',
      api_key_present: true,
      api_secret_present: true
    }

      at Object.<anonymous> (src/middleware/upload.ts:20:9)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    üîç Twilio Debug: {
      accountSid: 'ACcfacaa...',
      authToken: '658a6993...',
      phoneNumber: '8210224305'
    }

      at Object.<anonymous> (src/controllers/authController.ts:34:9)

  console.log
    üîç Twilio configuration: {
      hasAccountSid: true,
      hasAuthToken: true,
      phoneNumber: '+918210224305',
      isDevelopment: false
    }

      at Object.<anonymous> (src/controllers/authController.ts:47:9)

  console.log
    ‚úÖ Twilio client initialized successfully

      at Object.<anonymous> (src/controllers/authController.ts:59:13)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚òÅÔ∏è  [CLOUDINARY] Configuration loaded: {
      cloud_name: 'dsuakj68p',
      api_key_present: true,
      api_secret_present: true
    }

      at Object.<anonymous> (src/middleware/upload.ts:20:9)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `merchants.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test database disconnection failed: TypeError: Cannot read properties of undefined (reading 'stop')
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\setup.ts:36:23)

    [0m [90m 37 |[39m     console[33m.[39mlog([32m'‚úÖ Test database disconnected'[39m)[33m;[39m
     [90m 38 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 39 |[39m     console[33m.[39merror([32m'‚ùå Test database disconnection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 40 |[39m   }
     [90m 41 |[39m })[33m;[39m
     [90m 42 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:39:13)

FAIL src/__tests__/routes/team.test.ts (83.948 s)
  Team Routes
    GET /api/merchant/team
      √ó should get all team members (10235 ms)
    POST /api/merchant/team/invite
      √ó should invite a team member (10065 ms)
    PUT /api/merchant/team/:userId/role
      √ó should update team member role (owner only) (10107 ms)

  ‚óè Team Routes ‚Ä∫ GET /api/merchant/team ‚Ä∫ should get all team members

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Team Routes ‚Ä∫ POST /api/merchant/team/invite ‚Ä∫ should invite a team member

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Team Routes ‚Ä∫ PUT /api/merchant/team/:userId/role ‚Ä∫ should update team member role (owner only)

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\e2e\team-collaboration.e2e.test.ts:6:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:891:7)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/e2e/team-collaboration.e2e.test.ts:6:26)

  console.error
    ‚ùå Test database disconnection failed: TypeError: Cannot read properties of undefined (reading 'stop')
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\setup.ts:36:23)

    [0m [90m 37 |[39m     console[33m.[39mlog([32m'‚úÖ Test database disconnected'[39m)[33m;[39m
     [90m 38 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 39 |[39m     console[33m.[39merror([32m'‚ùå Test database disconnection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 40 |[39m   }
     [90m 41 |[39m })[33m;[39m
     [90m 42 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:39:13)

(node:37564) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:2324) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:2324) [MONGOOSE] Warning: Duplicate schema index on {"location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL src/__tests__/e2e/team-collaboration.e2e.test.ts (86.694 s)
  E2E: Team Collaboration
    √ó 1. Owner creates merchant account (10121 ms)
    √ó 2. Owner invites admin (10028 ms)
    √ó 3. Admin invites manager (10031 ms)
    √ó 4. Manager creates product (has permission) (10033 ms)

  ‚óè E2E: Team Collaboration ‚Ä∫ 1. Owner creates merchant account

    Cannot unlock file "C:\Users\Mukul raj\.cache\mongodb-binaries\7.0.14.lock", because it is not locked by this process

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at LockFile.unlock (node_modules/mongodb-memory-server-core/src/util/lockfile.ts:275:15)
      at Function.download (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:52:7)
      at Function.getPath (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:132:22)
      at MongoInstance.start (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:366:22)
      at Function.create (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:294:5)
      at MongoMemoryServer._startUpInstance (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:530:22)
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  ‚óè E2E: Team Collaboration ‚Ä∫ 2. Owner invites admin

    Cannot unlock file "C:\Users\Mukul raj\.cache\mongodb-binaries\7.0.14.lock", because it is not locked by this process

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at LockFile.unlock (node_modules/mongodb-memory-server-core/src/util/lockfile.ts:275:15)
      at Function.download (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:52:7)
      at Function.getPath (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:132:22)
      at MongoInstance.start (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:366:22)
      at Function.create (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:294:5)
      at MongoMemoryServer._startUpInstance (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:530:22)
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  ‚óè E2E: Team Collaboration ‚Ä∫ 3. Admin invites manager

    Cannot unlock file "C:\Users\Mukul raj\.cache\mongodb-binaries\7.0.14.lock", because it is not locked by this process

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at LockFile.unlock (node_modules/mongodb-memory-server-core/src/util/lockfile.ts:275:15)
      at Function.download (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:52:7)
      at Function.getPath (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:132:22)
      at MongoInstance.start (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:366:22)
      at Function.create (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:294:5)
      at MongoMemoryServer._startUpInstance (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:530:22)
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  ‚óè E2E: Team Collaboration ‚Ä∫ 4. Manager creates product (has permission)

    Cannot unlock file "C:\Users\Mukul raj\.cache\mongodb-binaries\7.0.14.lock", because it is not locked by this process

    [0m [90m  7 |[39m beforeAll([36masync[39m () [33m=>[39m {
     [90m  8 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m  9 |[39m     mongoServer [33m=[39m [36mawait[39m [33mMongoMemoryServer[39m[33m.[39mcreate()[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 10 |[39m     [36mconst[39m mongoUri [33m=[39m mongoServer[33m.[39mgetUri()[33m;[39m
     [90m 11 |[39m
     [90m 12 |[39m     [36mawait[39m mongoose[33m.[39mconnect(mongoUri)[33m;[39m[0m

      at LockFile.unlock (node_modules/mongodb-memory-server-core/src/util/lockfile.ts:275:15)
      at Function.download (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:52:7)
      at Function.getPath (node_modules/mongodb-memory-server-core/src/util/MongoBinary.ts:132:22)
      at MongoInstance.start (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:366:22)
      at Function.create (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:294:5)
      at MongoMemoryServer._startUpInstance (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:530:22)
      at MongoMemoryServer.start (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:350:5)
      at Function.create (node_modules/mongodb-memory-server-core/src/MongoMemoryServer.ts:317:5)
      at Object.<anonymous> (src/__tests__/setup.ts:9:19)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

FAIL src/__tests__/gamification-new-endpoints.test.ts (89.946 s)
  New Gamification Endpoints
    GET /api/gamification/challenges/my-progress
      ‚àö should return user challenge progress with stats (181 ms)
      √ó should require authentication (74 ms)
    GET /api/gamification/streaks
      ‚àö should return current user login streak (64 ms)
      ‚àö should handle authentication error (31 ms)
    GET /api/gamification/stats
      √ó should return comprehensive gamification stats (25284 ms)
      √ó should require authentication (23 ms)
      √ó should handle missing data gracefully (5 ms)

  ‚óè New Gamification Endpoints ‚Ä∫ GET /api/gamification/challenges/my-progress ‚Ä∫ should require authentication

    expect(received).rejects.toThrow()

    Matcher error: received value must be a promise or a function returning a promise

    Received has value: undefined

    [0m [90m 115 |[39m       [36mawait[39m expect(
     [90m 116 |[39m         getMyChallengeProgress(mockReq [36mas[39m [33mRequest[39m[33m,[39m mockRes [36mas[39m [33mResponse[39m[33m,[39m jest[33m.[39mfn())
    [31m[1m>[22m[39m[90m 117 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m'Authentication required'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 118 |[39m     })[33m;[39m
     [90m 119 |[39m   })[33m;[39m
     [90m 120 |[39m[0m

      at Object.toThrow (node_modules/expect/build/index.js:2153:11)
      at Object.<anonymous> (src/__tests__/gamification-new-endpoints.test.ts:117:17)

  ‚óè New Gamification Endpoints ‚Ä∫ GET /api/gamification/stats ‚Ä∫ should return comprehensive gamification stats

    TypeError: Cannot set properties of undefined (setting 'find')

    [0m [90m 192 |[39m       })[33m;[39m
     [90m 193 |[39m
    [31m[1m>[22m[39m[90m 194 |[39m       [33mUserAchievement[39m[33m.[39mfind [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue({
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 195 |[39m         countDocuments[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([35m12[39m)
     [90m 196 |[39m       })[33m;[39m
     [90m 197 |[39m[0m

      at Object.<anonymous> (src/__tests__/gamification-new-endpoints.test.ts:194:27)

  ‚óè New Gamification Endpoints ‚Ä∫ GET /api/gamification/stats ‚Ä∫ should require authentication

    expect(received).rejects.toThrow()

    Matcher error: received value must be a promise or a function returning a promise

    Received has value: undefined

    [0m [90m 241 |[39m       [36mawait[39m expect(
     [90m 242 |[39m         getGamificationStats(mockReq [36mas[39m [33mRequest[39m[33m,[39m mockRes [36mas[39m [33mResponse[39m[33m,[39m jest[33m.[39mfn())
    [31m[1m>[22m[39m[90m 243 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m'Authentication required'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 244 |[39m     })[33m;[39m
     [90m 245 |[39m
     [90m 246 |[39m     it([32m'should handle missing data gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toThrow (node_modules/expect/build/index.js:2153:11)
      at Object.<anonymous> (src/__tests__/gamification-new-endpoints.test.ts:243:17)

  ‚óè New Gamification Endpoints ‚Ä∫ GET /api/gamification/stats ‚Ä∫ should handle missing data gracefully

    TypeError: Cannot set properties of undefined (setting 'find')

    [0m [90m 262 |[39m         totalCoinsEarned[33m:[39m [35m0[39m
     [90m 263 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 264 |[39m       [33mUserAchievement[39m[33m.[39mfind [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue({
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 265 |[39m         countDocuments[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([35m0[39m)
     [90m 266 |[39m       })[33m;[39m
     [90m 267 |[39m       leaderboardService[33m.[39mgetAllUserRanks[33m.[39mmockResolvedValue({})[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/gamification-new-endpoints.test.ts:264:27)

  console.log
    ‚úÖ [PAYMENT GATEWAY] Stripe initialized

      at new PaymentGatewayService (src/services/paymentGatewayService.ts:90:15)

  console.log
    ‚úÖ [PAYMENT GATEWAY] Stripe initialized

      at new PaymentGatewayService (src/services/paymentGatewayService.ts:90:15)

  console.log
    ‚úÖ [STRIPE SERVICE] Stripe initialized successfully

      at StripeService.initializeStripe (src/services/stripeService.ts:28:15)

  console.log
    ‚úÖ [STRIPE SERVICE] Stripe initialized successfully

      at StripeService.initializeStripe (src/services/stripeService.ts:28:15)

  console.log
    ‚ö†Ô∏è  Rate limiting is DISABLED for development

      at Object.<anonymous> (src/middleware/rateLimiter.ts:23:11)

  console.log
    ‚ö†Ô∏è  Rate limiting is DISABLED for development

      at Object.<anonymous> (src/middleware/rateLimiter.ts:23:11)

  console.log
    [dotenv@17.2.1] injecting env (75) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\OnboardingService.test.ts:7:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:7:26)

(node:2324) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\OnboardingService.test.ts:7:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:7:26)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\OnboardingService.test.ts:7:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:7:26)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\OnboardingService.test.ts:7:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:7:26)

  console.error
    Cleanup error: ModuleNotFoundError: Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'
        at Resolver._throwModNotFoundError (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:863:11)
        at Resolver.resolveModule (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:810:10)
        at Resolver._getVirtualMockPath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:1004:84)
        at Resolver._getAbsolutePath (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:984:98)
        at Resolver.getModuleID (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-resolve\build\index.js:949:31)
        at Runtime._shouldMockCjs (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:1486:37)
        at Runtime.requireModuleOrMock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runtime\build\index.js:961:16)
        at cleanupTestData (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\helpers\testUtils.ts:171:32)
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\services\OnboardingService.test.ts:7:26)
        at Promise.finally.completed (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusHook (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:976:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:949:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'MODULE_NOT_FOUND',
      hint: '',
      requireStack: undefined,
      siblingWithSimilarExtensionFound: false,
      moduleName: '../../models/TeamInvitation',
      _originalMessage: "Cannot find module '../../models/TeamInvitation' from 'src/__tests__/helpers/testUtils.ts'"
    }

    [0m [90m 180 |[39m     ])[33m;[39m
     [90m 181 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 182 |[39m     console[33m.[39merror([32m'Cleanup error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 183 |[39m   }
     [90m 184 |[39m }[33m;[39m
     [90m 185 |[39m[0m

      at cleanupTestData (src/__tests__/helpers/testUtils.ts:182:13)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:7:26)

  console.log
    ‚úÖ Twilio SMS client initialized

      at new PushNotificationService (src/services/pushNotificationService.ts:43:17)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    üîç Twilio Debug: {
      accountSid: 'ACcfacaa...',
      authToken: '658a6993...',
      phoneNumber: '8210224305'
    }

      at Object.<anonymous> (src/controllers/authController.ts:34:9)

  console.log
    üîç Twilio configuration: {
      hasAccountSid: true,
      hasAuthToken: true,
      phoneNumber: '+918210224305',
      isDevelopment: false
    }

      at Object.<anonymous> (src/controllers/authController.ts:47:9)

  console.log
    ‚úÖ Twilio client initialized successfully

      at Object.<anonymous> (src/controllers/authController.ts:59:13)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

FAIL src/__tests__/services/OnboardingService.test.ts (95.236 s)
  OnboardingService
    getOnboardingStatus
      ‚àö should return onboarding status for a merchant (816 ms)
      ‚àö should throw error for non-existent merchant (269 ms)
    saveStepData
      √ó should save business info (step 1) (319 ms)
      ‚àö should throw error for invalid step number (597 ms)
    completeStep
      √ó should mark step as completed (211 ms)

  ‚óè OnboardingService ‚Ä∫ saveStepData ‚Ä∫ should save business info (step 1)

    Invalid GST number format

    [0m [90m 468 |[39m     [90m// Validate GST format (if provided)[39m
     [90m 469 |[39m     [36mif[39m (data[33m.[39mgstNumber [33m&&[39m [33m![39m[36mthis[39m[33m.[39misValidGST(data[33m.[39mgstNumber)) {
    [31m[1m>[22m[39m[90m 470 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Invalid GST number format'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 471 |[39m     }
     [90m 472 |[39m
     [90m 473 |[39m     [90m// Validate PAN format (if provided)[39m[0m

      at Function.validateBusinessInfo (src/merchantservices/OnboardingService.ts:470:13)
      at Function.saveStepData (src/merchantservices/OnboardingService.ts:92:20)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:42:22)

  ‚óè OnboardingService ‚Ä∫ completeStep ‚Ä∫ should mark step as completed

    Step 1 data is incomplete or invalid

    [0m [90m 156 |[39m
     [90m 157 |[39m     [36mif[39m ([33m![39mstepDataValid) {
    [31m[1m>[22m[39m[90m 158 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Step ${stepNumber} data is incomplete or invalid`[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 159 |[39m     }
     [90m 160 |[39m
     [90m 161 |[39m     [90m// Add to completed steps if not already there[39m[0m

      at Function.completeStep (src/merchantservices/OnboardingService.ts:158:13)
      at Object.<anonymous> (src/__tests__/services/OnboardingService.test.ts:65:22)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚òÅÔ∏è  [CLOUDINARY] Configuration loaded: {
      cloud_name: 'dsuakj68p',
      api_key_present: true,
      api_secret_present: true
    }

      at Object.<anonymous> (src/middleware/upload.ts:20:9)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.log
    ‚úÖ [PAYMENT GATEWAY] Stripe initialized

      at new PaymentGatewayService (src/services/paymentGatewayService.ts:90:15)

  console.log
    ‚úÖ [STRIPE SERVICE] Stripe initialized successfully

      at StripeService.initializeStripe (src/services/stripeService.ts:28:15)

  console.log
    ‚ö†Ô∏è  Rate limiting is DISABLED for development

      at Object.<anonymous> (src/middleware/rateLimiter.ts:23:11)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.log
    üîí [SUBSCRIPTION ROUTES] Setting up protected routes with authentication

      at Object.<anonymous> (src/routes/subscriptionRoutes.ts:40:9)

  console.log
    üîí [SUBSCRIPTION ROUTES] Setting up protected routes with authentication

      at Object.<anonymous> (src/routes/subscriptionRoutes.ts:40:9)

  console.log
    üîí [SUBSCRIPTION ROUTES] Setting up protected routes with authentication

      at Object.<anonymous> (src/routes/subscriptionRoutes.ts:40:9)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.warn
    ‚ö†Ô∏è [OCR SERVICE] No OCR provider configured, using manual extraction

    [0m [90m 64 |[39m     } [36melse[39m {
     [90m 65 |[39m       [36mthis[39m[33m.[39mprovider [33m=[39m [32m'manual'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 66 |[39m       console[33m.[39mwarn([32m'‚ö†Ô∏è [OCR SERVICE] No OCR provider configured, using manual extraction'[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 67 |[39m     }
     [90m 68 |[39m   }
     [90m 69 |[39m[0m

      at new OCRService (src/services/ocrService.ts:66:15)
      at Object.<anonymous> (src/services/ocrService.ts:502:27)
      at Object.<anonymous> (src/services/billVerificationService.ts:9:1)
      at Object.<anonymous> (src/controllers/billController.ts:7:1)
      at Object.<anonymous> (src/routes/billRoutes.ts:2:1)
      at Object.<anonymous> (src/server.ts:86:1)
      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:2:1)

  console.warn
    ‚ö†Ô∏è [OCR SERVICE] No OCR provider configured, using manual extraction

    [0m [90m 64 |[39m     } [36melse[39m {
     [90m 65 |[39m       [36mthis[39m[33m.[39mprovider [33m=[39m [32m'manual'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 66 |[39m       console[33m.[39mwarn([32m'‚ö†Ô∏è [OCR SERVICE] No OCR provider configured, using manual extraction'[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 67 |[39m     }
     [90m 68 |[39m   }
     [90m 69 |[39m[0m

      at new OCRService (src/services/ocrService.ts:66:15)
      at Object.<anonymous> (src/services/ocrService.ts:502:27)
      at Object.<anonymous> (src/services/billVerificationService.ts:9:1)
      at Object.<anonymous> (src/controllers/billController.ts:7:1)
      at Object.<anonymous> (src/routes/billRoutes.ts:2:1)
      at Object.<anonymous> (src/server.ts:86:1)
      at Object.<anonymous> (src/__tests__/merchantProducts.test.ts:2:1)

  console.warn
    ‚ö†Ô∏è [OCR SERVICE] No OCR provider configured, using manual extraction

    [0m [90m 64 |[39m     } [36melse[39m {
     [90m 65 |[39m       [36mthis[39m[33m.[39mprovider [33m=[39m [32m'manual'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 66 |[39m       console[33m.[39mwarn([32m'‚ö†Ô∏è [OCR SERVICE] No OCR provider configured, using manual extraction'[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 67 |[39m     }
     [90m 68 |[39m   }
     [90m 69 |[39m[0m

      at new OCRService (src/services/ocrService.ts:66:15)
      at Object.<anonymous> (src/services/ocrService.ts:502:27)
      at Object.<anonymous> (src/services/billVerificationService.ts:9:1)
      at Object.<anonymous> (src/controllers/billController.ts:7:1)
      at Object.<anonymous> (src/routes/billRoutes.ts:2:1)
      at Object.<anonymous> (src/server.ts:86:1)
      at Object.<anonymous> (src/__tests__/partnerAPI.test.ts:9:1)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.warn
    API key does not start with "SG.".

    [0m [90m 4 |[39m [36mconst[39m [33mSENDGRID_API_KEY[39m [33m=[39m process[33m.[39menv[33m.[39m[33mSENDGRID_API_KEY[39m[33m;[39m
     [90m 5 |[39m [36mif[39m ([33mSENDGRID_API_KEY[39m) {
    [31m[1m>[22m[39m[90m 6 |[39m   sgMail[33m.[39msetApiKey([33mSENDGRID_API_KEY[39m)[33m;[39m
     [90m   |[39m          [31m[1m^[22m[39m
     [90m 7 |[39m }
     [90m 8 |[39m
     [90m 9 |[39m [36mexport[39m [36minterface[39m [33mEmailOptions[39m {[0m

      at Client.setApiKey (node_modules/@sendgrid/client/src/classes/client.js:44:15)
      at MailService.setApiKey (node_modules/@sendgrid/mail/src/classes/mail-service.js:38:17)
      at Object.<anonymous> (src/services/EmailService.ts:6:10)
      at Object.<anonymous> (src/merchantroutes/auth.ts:13:1)
      at Object.<anonymous> (src/server.ts:98:1)
      at Object.<anonymous> (src/__tests__/merchantProducts.test.ts:2:1)

  console.warn
    API key does not start with "SG.".

    [0m [90m 4 |[39m [36mconst[39m [33mSENDGRID_API_KEY[39m [33m=[39m process[33m.[39menv[33m.[39m[33mSENDGRID_API_KEY[39m[33m;[39m
     [90m 5 |[39m [36mif[39m ([33mSENDGRID_API_KEY[39m) {
    [31m[1m>[22m[39m[90m 6 |[39m   sgMail[33m.[39msetApiKey([33mSENDGRID_API_KEY[39m)[33m;[39m
     [90m   |[39m          [31m[1m^[22m[39m
     [90m 7 |[39m }
     [90m 8 |[39m
     [90m 9 |[39m [36mexport[39m [36minterface[39m [33mEmailOptions[39m {[0m

      at Client.setApiKey (node_modules/@sendgrid/client/src/classes/client.js:44:15)
      at MailService.setApiKey (node_modules/@sendgrid/mail/src/classes/mail-service.js:38:17)
      at Object.<anonymous> (src/services/EmailService.ts:6:10)
      at Object.<anonymous> (src/merchantroutes/auth.ts:13:1)
      at Object.<anonymous> (src/server.ts:98:1)
      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:2:1)

  console.warn
    API key does not start with "SG.".

    [0m [90m 4 |[39m [36mconst[39m [33mSENDGRID_API_KEY[39m [33m=[39m process[33m.[39menv[33m.[39m[33mSENDGRID_API_KEY[39m[33m;[39m
     [90m 5 |[39m [36mif[39m ([33mSENDGRID_API_KEY[39m) {
    [31m[1m>[22m[39m[90m 6 |[39m   sgMail[33m.[39msetApiKey([33mSENDGRID_API_KEY[39m)[33m;[39m
     [90m   |[39m          [31m[1m^[22m[39m
     [90m 7 |[39m }
     [90m 8 |[39m
     [90m 9 |[39m [36mexport[39m [36minterface[39m [33mEmailOptions[39m {[0m

      at Client.setApiKey (node_modules/@sendgrid/client/src/classes/client.js:44:15)
      at MailService.setApiKey (node_modules/@sendgrid/mail/src/classes/mail-service.js:38:17)
      at Object.<anonymous> (src/services/EmailService.ts:6:10)
      at Object.<anonymous> (src/merchantroutes/auth.ts:13:1)
      at Object.<anonymous> (src/server.ts:98:1)
      at Object.<anonymous> (src/__tests__/partnerAPI.test.ts:9:1)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚úÖ Swagger documentation available at /api-docs

      at Object.<anonymous> (src/server.ts:213:9)

  console.log
    ‚úÖ Messaging routes registered at /api/messages

      at Object.<anonymous> (src/server.ts:447:9)

  console.log
    ‚úÖ Billing routes registered at /api/billing

      at Object.<anonymous> (src/server.ts:462:9)

  console.log
    ‚úÖ Bill routes registered at /api/bills

      at Object.<anonymous> (src/server.ts:466:9)

  console.log
    ‚úÖ Unified gamification routes registered at /api/gamification

      at Object.<anonymous> (src/server.ts:470:9)

  console.log
    ‚úÖ Social feed routes registered at /api/social

      at Object.<anonymous> (src/server.ts:474:9)

  console.log
    ‚úÖ Partner program routes registered at /api/partner

      at Object.<anonymous> (src/server.ts:478:9)

  console.log
    ‚úÖ Earnings routes registered at /api/earnings

      at Object.<anonymous> (src/server.ts:482:9)

  console.log
    ‚úÖ Menu routes registered at /api/menu

      at Object.<anonymous> (src/server.ts:486:9)

  console.log
    ‚úÖ Table booking routes registered at /api/table-bookings

      at Object.<anonymous> (src/server.ts:490:9)

  console.log
    ‚úÖ Service appointment routes registered at /api/service-appointments

      at Object.<anonymous> (src/server.ts:494:9)

  console.log
    ‚úÖ Consultation routes registered at /api/consultations

      at Object.<anonymous> (src/server.ts:498:9)

  console.log
    ‚úÖ Store visit routes registered at /api/store-visits

      at Object.<anonymous> (src/server.ts:502:9)

  console.log
    ‚úÖ Homepage routes registered at /api/homepage

      at Object.<anonymous> (src/server.ts:506:9)

  console.log
    ‚úÖ General rate limiter applied to merchant routes

      at Object.<anonymous> (src/server.ts:511:9)

  console.log
    ‚úÖ Enhanced merchant order routes registered at /api/merchant/orders (Agent 7)

      at Object.<anonymous> (src/server.ts:521:9)

  console.log
    ‚úÖ Enhanced merchant cashback routes registered at /api/merchant/cashback (Agent 5)

      at Object.<anonymous> (src/server.ts:526:9)

  console.log
    ‚úÖ Merchant onboarding routes registered at /api/merchant/onboarding (Agent 1)

      at Object.<anonymous> (src/server.ts:542:9)

  console.log
    ‚úÖ Bulk product operations routes registered at /api/merchant/bulk (Agent 4)

      at Object.<anonymous> (src/server.ts:546:9)

  console.log
    ‚úÖ Merchant notification routes registered at /api/merchant/notifications (Agent 2)

      at Object.<anonymous> (src/server.ts:550:9)

  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚úÖ Stock Socket Service initialized

      at StockSocketService.initialize (src/services/stockSocketService.ts:49:13)

  console.log
    ‚úÖ [EARNINGS SOCKET] Earnings socket service initialized

      at EarningsSocketService.initialize (src/services/earningsSocketService.ts:25:13)

  console.log
    üìä Automated reporting service initialized

      at Function.initialize (src/merchantservices/ReportService.ts:49:13)

  console.log
    ‚úÖ Swagger documentation available at /api-docs

      at Object.<anonymous> (src/server.ts:213:9)

(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"razorpaySubscriptionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"phoneNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"referral.referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"profile.location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"username":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"scheduledAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"batchId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"campaignId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"sku":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"requestNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"moderationStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"moderationStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"sharing.shareCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"voucherCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"order":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"bookingReference":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"consultationNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"eventId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"subscriptionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"cashbackStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"billImage.imageHash":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:18428) [MONGOOSE] Warning: Duplicate schema index on {"bookingNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ Messaging routes registered at /api/messages

      at Object.<anonymous> (src/server.ts:447:9)

  console.log
    ‚úÖ Billing routes registered at /api/billing

      at Object.<anonymous> (src/server.ts:462:9)

  console.log
    ‚úÖ Bill routes registered at /api/bills

      at Object.<anonymous> (src/server.ts:466:9)

  console.log
    ‚úÖ Unified gamification routes registered at /api/gamification

      at Object.<anonymous> (src/server.ts:470:9)

  console.log
    ‚úÖ Social feed routes registered at /api/social

      at Object.<anonymous> (src/server.ts:474:9)

  console.log
    ‚úÖ Partner program routes registered at /api/partner

      at Object.<anonymous> (src/server.ts:478:9)

  console.log
    ‚úÖ Earnings routes registered at /api/earnings

      at Object.<anonymous> (src/server.ts:482:9)

  console.log
    ‚úÖ Menu routes registered at /api/menu

      at Object.<anonymous> (src/server.ts:486:9)

  console.log
    ‚úÖ Table booking routes registered at /api/table-bookings

      at Object.<anonymous> (src/server.ts:490:9)

  console.log
    ‚úÖ Service appointment routes registered at /api/service-appointments

      at Object.<anonymous> (src/server.ts:494:9)

  console.log
    ‚úÖ Consultation routes registered at /api/consultations

      at Object.<anonymous> (src/server.ts:498:9)

  console.log
    ‚úÖ Store visit routes registered at /api/store-visits

      at Object.<anonymous> (src/server.ts:502:9)

  console.log
    ‚úÖ Homepage routes registered at /api/homepage

      at Object.<anonymous> (src/server.ts:506:9)

  console.log
    ‚úÖ General rate limiter applied to merchant routes

      at Object.<anonymous> (src/server.ts:511:9)

  console.log
    ‚úÖ Enhanced merchant order routes registered at /api/merchant/orders (Agent 7)

      at Object.<anonymous> (src/server.ts:521:9)

  console.log
    ‚úÖ Enhanced merchant cashback routes registered at /api/merchant/cashback (Agent 5)

      at Object.<anonymous> (src/server.ts:526:9)

  console.log
    ‚úÖ Merchant onboarding routes registered at /api/merchant/onboarding (Agent 1)

      at Object.<anonymous> (src/server.ts:542:9)

  console.log
    ‚úÖ Bulk product operations routes registered at /api/merchant/bulk (Agent 4)

      at Object.<anonymous> (src/server.ts:546:9)

  console.log
    ‚úÖ Merchant notification routes registered at /api/merchant/notifications (Agent 2)

      at Object.<anonymous> (src/server.ts:550:9)

  console.log
    ‚úÖ Stock Socket Service initialized

      at StockSocketService.initialize (src/services/stockSocketService.ts:49:13)

  console.log
    ‚úÖ [EARNINGS SOCKET] Earnings socket service initialized

      at EarningsSocketService.initialize (src/services/earningsSocketService.ts:25:13)

  console.log
    üìä Automated reporting service initialized

      at Function.initialize (src/merchantservices/ReportService.ts:49:13)

(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"razorpaySubscriptionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"phoneNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"referral.referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"profile.location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"username":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"scheduledAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"batchId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"campaignId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"sku":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"requestNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"moderationStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"moderationStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"sharing.shareCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"voucherCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"order":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"bookingReference":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"consultationNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"eventId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"subscriptionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"cashbackStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"billImage.imageHash":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:14600) [MONGOOSE] Warning: Duplicate schema index on {"bookingNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    [dotenv@17.2.1] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:139:11)

  console.log
    ‚úÖ Swagger documentation available at /api-docs

      at Object.<anonymous> (src/server.ts:213:9)

  console.log
    ‚úÖ Messaging routes registered at /api/messages

      at Object.<anonymous> (src/server.ts:447:9)

  console.log
    ‚úÖ Billing routes registered at /api/billing

      at Object.<anonymous> (src/server.ts:462:9)

  console.log
    ‚úÖ Bill routes registered at /api/bills

      at Object.<anonymous> (src/server.ts:466:9)

  console.log
    ‚úÖ Unified gamification routes registered at /api/gamification

      at Object.<anonymous> (src/server.ts:470:9)

  console.log
    ‚úÖ Social feed routes registered at /api/social

      at Object.<anonymous> (src/server.ts:474:9)

  console.log
    ‚úÖ Partner program routes registered at /api/partner

      at Object.<anonymous> (src/server.ts:478:9)

  console.log
    ‚úÖ Earnings routes registered at /api/earnings

      at Object.<anonymous> (src/server.ts:482:9)

  console.log
    ‚úÖ Menu routes registered at /api/menu

      at Object.<anonymous> (src/server.ts:486:9)

  console.log
    ‚úÖ Table booking routes registered at /api/table-bookings

      at Object.<anonymous> (src/server.ts:490:9)

  console.log
    ‚úÖ Service appointment routes registered at /api/service-appointments

      at Object.<anonymous> (src/server.ts:494:9)

  console.log
    ‚úÖ Consultation routes registered at /api/consultations

      at Object.<anonymous> (src/server.ts:498:9)

  console.log
    ‚úÖ Store visit routes registered at /api/store-visits

      at Object.<anonymous> (src/server.ts:502:9)

  console.log
    ‚úÖ Homepage routes registered at /api/homepage

      at Object.<anonymous> (src/server.ts:506:9)

  console.log
    ‚úÖ General rate limiter applied to merchant routes

      at Object.<anonymous> (src/server.ts:511:9)

  console.log
    ‚úÖ Enhanced merchant order routes registered at /api/merchant/orders (Agent 7)

      at Object.<anonymous> (src/server.ts:521:9)

  console.log
    ‚úÖ Enhanced merchant cashback routes registered at /api/merchant/cashback (Agent 5)

      at Object.<anonymous> (src/server.ts:526:9)

  console.log
    ‚úÖ Merchant onboarding routes registered at /api/merchant/onboarding (Agent 1)

      at Object.<anonymous> (src/server.ts:542:9)

  console.log
    ‚úÖ Bulk product operations routes registered at /api/merchant/bulk (Agent 4)

      at Object.<anonymous> (src/server.ts:546:9)

  console.log
    ‚úÖ Merchant notification routes registered at /api/merchant/notifications (Agent 2)

      at Object.<anonymous> (src/server.ts:550:9)

  console.log
    ‚úÖ Stock Socket Service initialized

      at StockSocketService.initialize (src/services/stockSocketService.ts:49:13)

  console.log
    ‚úÖ [EARNINGS SOCKET] Earnings socket service initialized

      at EarningsSocketService.initialize (src/services/earningsSocketService.ts:25:13)

  console.log
    üìä Automated reporting service initialized

      at Function.initialize (src/merchantservices/ReportService.ts:49:13)

  console.log
    ‚úÖ Partner API Integration Tests Completed

      at Object.<anonymous> (src/__tests__/partnerAPI.test.ts:251:9)

  console.log
    ‚úÖ [CLOUDINARY] Connection successful!

      at src/middleware/upload.ts:29:13

(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"razorpaySubscriptionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"phoneNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"referral.referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"profile.location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"referralCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"username":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"scheduledAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"batchId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"campaignId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"transactionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ [CLOUDINARY] Connection successful!

      at src/middleware/upload.ts:29:13

(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"sku":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"slug":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"location.coordinates":"2dsphere"} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"requestNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"moderationStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"moderationStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"sharing.shareCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"voucherCode":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"user":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"order":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"bookingReference":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"consultationNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"eventId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"subscriptionId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"cashbackStatus":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"billImage.imageHash":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"orderNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:36976) [MONGOOSE] Warning: Duplicate schema index on {"bookingNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.log
    ‚úÖ [CLOUDINARY] Connection successful!

      at src/middleware/upload.ts:29:13

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.log
    ‚úÖ Test database connected

      at Object.<anonymous> (src/__tests__/setup.ts:13:13)

  console.error
    ‚ùå Email send error: ResponseError: Unauthorized
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\@sendgrid\client\src\classes\client.js:146:29
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      code: 401,
      response: {
        headers: {
          server: 'nginx',
          date: 'Tue, 18 Nov 2025 06:40:16 GMT',
          'content-type': 'application/json',
          'content-length': '116',
          connection: 'keep-alive',
          'access-control-allow-origin': 'https://sendgrid.api-docs.io',
          'access-control-allow-methods': 'POST',
          'access-control-allow-headers': 'Authorization, Content-Type, On-behalf-of, x-sg-elas-acl',
          'access-control-max-age': '600',
          'x-no-cors-reason': 'https://sendgrid.com/docs/Classroom/Basics/API/cors.html',
          'strict-transport-security': 'max-age=31536000; includeSubDomains',
          'content-security-policy': "frame-ancestors 'none'",
          'cache-control': 'no-cache',
          'x-content-type-options': 'no-sniff',
          'referrer-policy': 'strict-origin-when-cross-origin'
        },
        body: { errors: [Array] }
      }
    }

    [0m [90m 56 |[39m       console[33m.[39mlog([32m`‚úÖ Email sent successfully to ${options.to}`[39m)[33m;[39m
     [90m 57 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 58 |[39m       console[33m.[39merror([32m'‚ùå Email send error:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 59 |[39m       [36mif[39m (error[33m.[39mresponse) {
     [90m 60 |[39m         console[33m.[39merror([32m'SendGrid error response:'[39m[33m,[39m error[33m.[39mresponse[33m.[39mbody)[33m;[39m
     [90m 61 |[39m       }[0m

      at Function.send (src/services/EmailService.ts:58:15)
      at Function.sendEmailVerification (src/services/EmailService.ts:235:5)
      at sendVerificationEmail (src/merchantroutes/auth.ts:128:5)
      at src/merchantroutes/auth.ts:317:5

  console.error
    SendGrid error response: {
      errors: [
        {
          message: 'The provided authorization grant is invalid, expired, or revoked',
          field: null,
          help: null
        }
      ]
    }

    [0m [90m 58 |[39m       console[33m.[39merror([32m'‚ùå Email send error:'[39m[33m,[39m error)[33m;[39m
     [90m 59 |[39m       [36mif[39m (error[33m.[39mresponse) {
    [31m[1m>[22m[39m[90m 60 |[39m         console[33m.[39merror([32m'SendGrid error response:'[39m[33m,[39m error[33m.[39mresponse[33m.[39mbody)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 61 |[39m       }
     [90m 62 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Failed to send email: ${error.message}`[39m)[33m;[39m
     [90m 63 |[39m     }[0m

      at Function.send (src/services/EmailService.ts:60:17)
      at Function.sendEmailVerification (src/services/EmailService.ts:235:5)
      at sendVerificationEmail (src/merchantroutes/auth.ts:128:5)
      at src/merchantroutes/auth.ts:317:5

  console.error
    Failed to send verification email: Error: Failed to send email: Unauthorized
        at Function.send (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\EmailService.ts:62:13)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Function.sendEmailVerification (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\EmailService.ts:235:5)
        at sendVerificationEmail (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:128:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:317:5

    [0m [90m 132 |[39m     )[33m;[39m
     [90m 133 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 134 |[39m     console[33m.[39merror([32m'Failed to send verification email:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 135 |[39m     [90m// Don't throw error - just log it so registration can continue[39m
     [90m 136 |[39m   }
     [90m 137 |[39m }[0m

      at sendVerificationEmail (src/merchantroutes/auth.ts:134:13)
      at src/merchantroutes/auth.ts:317:5

  console.error
    Error creating store for merchant: Error: Category validation failed: type: `store` is not a valid enum value for path `type`.
        at ValidationError.inspect (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\error\validation.js:52:26)
        at formatValue (node:internal/util/inspect:805:19)
        at inspect (node:internal/util/inspect:364:10)
        at formatWithOptionsInternal (node:internal/util/inspect:2298:40)
        at format (node:internal/util/inspect:2155:10)
        at console.error (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\@jest\console\build\index.js:288:48)
        at createStoreForMerchant (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:1609:13)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:320:5 {
      errors: {
        type: ValidatorError: `store` is not a valid enum value for path `type`.
            at validate (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\schemaType.js:1407:13)
            at SchemaString.SchemaType.doValidate (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\schemaType.js:1391:7)
            at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\document.js:3111:18
            at processTicksAndRejections (node:internal/process/task_queues:77:11) {
          properties: [Object],
          kind: 'enum',
          path: 'type',
          value: 'store',
          reason: undefined,
          [Symbol(mongoose#validatorError)]: true
        }
      },
      _message: 'Category validation failed'
    }

    [0m [90m 1607 |[39m
     [90m 1608 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 1609 |[39m     console[33m.[39merror([32m'Error creating store for merchant:'[39m[33m,[39m error)[33m;[39m
     [90m      |[39m             [31m[1m^[22m[39m
     [90m 1610 |[39m     [90m// Don't throw error to avoid breaking merchant registration[39m
     [90m 1611 |[39m   }
     [90m 1612 |[39m }[0m

      at createStoreForMerchant (src/merchantroutes/auth.ts:1609:13)
      at src/merchantroutes/auth.ts:320:5

  console.log
    ‚úÖ Integration test database connected

      at Object.<anonymous> (src/__tests__/partnerAPI.test.ts:28:11)

  console.error
    ‚ùå Email send error: ResponseError: Unauthorized
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\@sendgrid\client\src\classes\client.js:146:29
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      code: 401,
      response: {
        headers: {
          server: 'nginx',
          date: 'Tue, 18 Nov 2025 06:40:20 GMT',
          'content-type': 'application/json',
          'content-length': '116',
          connection: 'keep-alive',
          'access-control-allow-origin': 'https://sendgrid.api-docs.io',
          'access-control-allow-methods': 'POST',
          'access-control-allow-headers': 'Authorization, Content-Type, On-behalf-of, x-sg-elas-acl',
          'access-control-max-age': '600',
          'x-no-cors-reason': 'https://sendgrid.com/docs/Classroom/Basics/API/cors.html',
          'strict-transport-security': 'max-age=31536000; includeSubDomains',
          'content-security-policy': "frame-ancestors 'none'",
          'cache-control': 'no-cache',
          'x-content-type-options': 'no-sniff',
          'referrer-policy': 'strict-origin-when-cross-origin'
        },
        body: { errors: [Array] }
      }
    }

    [0m [90m 56 |[39m       console[33m.[39mlog([32m`‚úÖ Email sent successfully to ${options.to}`[39m)[33m;[39m
     [90m 57 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 58 |[39m       console[33m.[39merror([32m'‚ùå Email send error:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 59 |[39m       [36mif[39m (error[33m.[39mresponse) {
     [90m 60 |[39m         console[33m.[39merror([32m'SendGrid error response:'[39m[33m,[39m error[33m.[39mresponse[33m.[39mbody)[33m;[39m
     [90m 61 |[39m       }[0m

      at Function.send (src/services/EmailService.ts:58:15)
      at Function.sendEmailVerification (src/services/EmailService.ts:235:5)
      at sendVerificationEmail (src/merchantroutes/auth.ts:128:5)
      at src/merchantroutes/auth.ts:317:5

  console.error
    SendGrid error response: {
      errors: [
        {
          message: 'The provided authorization grant is invalid, expired, or revoked',
          field: null,
          help: null
        }
      ]
    }

    [0m [90m 58 |[39m       console[33m.[39merror([32m'‚ùå Email send error:'[39m[33m,[39m error)[33m;[39m
     [90m 59 |[39m       [36mif[39m (error[33m.[39mresponse) {
    [31m[1m>[22m[39m[90m 60 |[39m         console[33m.[39merror([32m'SendGrid error response:'[39m[33m,[39m error[33m.[39mresponse[33m.[39mbody)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 61 |[39m       }
     [90m 62 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Failed to send email: ${error.message}`[39m)[33m;[39m
     [90m 63 |[39m     }[0m

      at Function.send (src/services/EmailService.ts:60:17)
      at Function.sendEmailVerification (src/services/EmailService.ts:235:5)
      at sendVerificationEmail (src/merchantroutes/auth.ts:128:5)
      at src/merchantroutes/auth.ts:317:5

  console.error
    Failed to send verification email: Error: Failed to send email: Unauthorized
        at Function.send (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\EmailService.ts:62:13)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Function.sendEmailVerification (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\EmailService.ts:235:5)
        at sendVerificationEmail (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:128:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:317:5

    [0m [90m 132 |[39m     )[33m;[39m
     [90m 133 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 134 |[39m     console[33m.[39merror([32m'Failed to send verification email:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 135 |[39m     [90m// Don't throw error - just log it so registration can continue[39m
     [90m 136 |[39m   }
     [90m 137 |[39m }[0m

      at sendVerificationEmail (src/merchantroutes/auth.ts:134:13)
      at src/merchantroutes/auth.ts:317:5

  console.error
    Error creating store for merchant: Error: Category validation failed: type: `store` is not a valid enum value for path `type`.
        at ValidationError.inspect (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\error\validation.js:52:26)
        at formatValue (node:internal/util/inspect:805:19)
        at inspect (node:internal/util/inspect:364:10)
        at formatWithOptionsInternal (node:internal/util/inspect:2298:40)
        at format (node:internal/util/inspect:2155:10)
        at console.error (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\@jest\console\build\index.js:288:48)
        at createStoreForMerchant (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:1609:13)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\merchantroutes\auth.ts:320:5 {
      errors: {
        type: ValidatorError: `store` is not a valid enum value for path `type`.
            at validate (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\schemaType.js:1407:13)
            at SchemaString.SchemaType.doValidate (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\schemaType.js:1391:7)
            at C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\document.js:3111:18
            at processTicksAndRejections (node:internal/process/task_queues:77:11) {
          properties: [Object],
          kind: 'enum',
          path: 'type',
          value: 'store',
          reason: undefined,
          [Symbol(mongoose#validatorError)]: true
        }
      },
      _message: 'Category validation failed'
    }

    [0m [90m 1607 |[39m
     [90m 1608 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 1609 |[39m     console[33m.[39merror([32m'Error creating store for merchant:'[39m[33m,[39m error)[33m;[39m
     [90m      |[39m             [31m[1m^[22m[39m
     [90m 1610 |[39m     [90m// Don't throw error to avoid breaking merchant registration[39m
     [90m 1611 |[39m   }
     [90m 1612 |[39m }[0m

      at createStoreForMerchant (src/merchantroutes/auth.ts:1609:13)
      at src/merchantroutes/auth.ts:320:5

  console.log
    ‚ö†Ô∏è Failed login attempt for login1763448020332@example.com. 4 attempts remaining.

      at src/merchantroutes/auth.ts:446:15

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/dashboard',
      method: 'GET',
      hasToken: false,
      tokenPreview: 'none'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.warn
    ‚ö†Ô∏è [AUTH] No token provided

    [0m [90m 62 |[39m
     [90m 63 |[39m     [36mif[39m ([33m![39mtoken) {
    [31m[1m>[22m[39m[90m 64 |[39m       console[33m.[39mwarn([32m'‚ö†Ô∏è [AUTH] No token provided'[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 65 |[39m       [36mreturn[39m res[33m.[39mstatus([35m401[39m)[33m.[39mjson({
     [90m 66 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 67 |[39m         message[33m:[39m [32m'Access token is required'[39m[0m

      at authenticate (src/middleware/auth.ts:64:15)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:147:12)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at compression (node_modules/compression/index.js:243:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:68:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at src/server.ts:179:5
      at jsonParser (node_modules/body-parser/lib/types/json.js:100:7)
      at src/server.ts:165:34
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at internalNext (node_modules/helmet/index.cjs:531:6)
      at xXssProtectionMiddleware (node_modules/helmet/index.cjs:311:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPoweredByMiddleware (node_modules/helmet/index.cjs:304:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPermittedCrossDomainPoliciesMiddleware (node_modules/helmet/index.cjs:297:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xFrameOptionsMiddleware (node_modules/helmet/index.cjs:281:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDownloadOptionsMiddleware (node_modules/helmet/index.cjs:261:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDnsPrefetchControlMiddleware (node_modules/helmet/index.cjs:254:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xContentTypeOptionsMiddleware (node_modules/helmet/index.cjs:246:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at strictTransportSecurityMiddleware (node_modules/helmet/index.cjs:239:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at referrerPolicyMiddleware (node_modules/helmet/index.cjs:207:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at originAgentClusterMiddleware (node_modules/helmet/index.cjs:182:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginResourcePolicyMiddleware (node_modules/helmet/index.cjs:175:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginOpenerPolicyMiddleware (node_modules/helmet/index.cjs:159:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at contentSecurityPolicyMiddleware (node_modules/helmet/index.cjs:124:4)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at helmetMiddleware (node_modules/helmet/index.cjs:533:6)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.log
    ‚ö†Ô∏è Failed login attempt for test1763448021710@example.com. 4 attempts remaining.

      at src/merchantroutes/auth.ts:446:15

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/dashboard',
      method: 'GET',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d6939e547764d1d73c', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d6939e547764d1d73c'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d6939e547764d1d73c')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.log
    üìù [REVIEW] User has 0 reviews

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:769:15)

  console.log
    üë• [REFERRAL] User has 0 referrals

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:786:15)

  console.log
    üì± [SOCIAL] User has 0 shares

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:806:15)

  console.log
    üìä [MILESTONE CHECK] User has 0 orders and spent ‚Çπ0

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:813:13)

  console.log
    ‚ÑπÔ∏è [MILESTONE] No new milestones unlocked

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:838:15)

  console.log
    ‚ö†Ô∏è Failed login attempt for lastlogin1763448022647@example.com. 4 attempts remaining.

      at src/merchantroutes/auth.ts:446:15

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/dashboard',
      method: 'GET',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d7939e547764d1d7d6', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d7939e547764d1d7d6'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d7939e547764d1d7d6')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.log
    üìù [REVIEW] User has 0 reviews

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:769:15)

  console.log
    üë• [REFERRAL] User has 0 referrals

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:786:15)

  console.log
    üì± [SOCIAL] User has 0 shares

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:806:15)

  console.log
    üìä [MILESTONE CHECK] User has 0 orders and spent ‚Çπ0

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:813:13)

  console.log
    ‚ÑπÔ∏è [MILESTONE] No new milestones unlocked

      at PartnerService.getPartnerDashboard (src/services/partnerService.ts:838:15)

  console.log
    üîç AUTH DEBUG: Request to /me

      at authMiddleware (src/middleware/merchantauth.ts:23:13)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/milestones/invalid-format/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d7939e547764d1d866', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    üîç AUTH DEBUG: Auth header exists: true

      at authMiddleware (src/middleware/merchantauth.ts:24:13)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d7939e547764d1d866'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d7939e547764d1d866')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîç AUTH DEBUG: Token exists: true

      at authMiddleware (src/middleware/merchantauth.ts:25:13)

  console.log
    üîç AUTH DEBUG: Token preview: eyJhbGciOiJIUzI1NiIs...

      at authMiddleware (src/middleware/merchantauth.ts:28:15)

  console.log
    üîç AUTH DEBUG: Verifying token with merchant secret

      at authMiddleware (src/middleware/merchantauth.ts:44:13)

  console.log
    üîç AUTH DEBUG: Token decoded successfully

      at authMiddleware (src/middleware/merchantauth.ts:46:13)

  console.log
    üîç AUTH DEBUG: MerchantId: undefined

      at authMiddleware (src/middleware/merchantauth.ts:47:13)

  console.log
    üîç AUTH DEBUG: MerchantUserId: undefined

      at authMiddleware (src/middleware/merchantauth.ts:48:13)

  console.log
    üîç AUTH DEBUG: Role: undefined

      at authMiddleware (src/middleware/merchantauth.ts:49:13)

  console.log
    üîç AUTH DEBUG: Merchant found: false

      at authMiddleware (src/middleware/merchantauth.ts:53:13)

  console.log
    üîç AUTH DEBUG: Merchant not found for ID: undefined

      at authMiddleware (src/middleware/merchantauth.ts:56:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/jackpot/35000/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d8939e547764d1d8f6', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    üîç AUTH DEBUG: Request to /me

      at authMiddleware (src/middleware/merchantauth.ts:23:13)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d8939e547764d1d8f6'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    üîç AUTH DEBUG: Auth header exists: true

      at authMiddleware (src/middleware/merchantauth.ts:24:13)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d8939e547764d1d8f6')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîç AUTH DEBUG: Token exists: true

      at authMiddleware (src/middleware/merchantauth.ts:25:13)

  console.log
    üîç AUTH DEBUG: Token preview: invalid-token...

      at authMiddleware (src/middleware/merchantauth.ts:28:15)

  console.log
    üîç AUTH DEBUG: Verifying token with merchant secret

      at authMiddleware (src/middleware/merchantauth.ts:44:13)

  console.error
    üîç AUTH DEBUG: Auth middleware error: JsonWebTokenError {
      name: 'JsonWebTokenError',
      message: 'jwt malformed'
    }

    [0m [90m 114 |[39m     [36mreturn[39m next()[33m;[39m
     [90m 115 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 116 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Auth middleware error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 117 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Error name:'[39m[33m,[39m error[33m.[39mname)[33m;[39m
     [90m 118 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Error message:'[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m 119 |[39m[0m

      at authMiddleware (src/middleware/merchantauth.ts:116:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:147:12)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at compression (node_modules/compression/index.js:243:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:68:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at src/server.ts:179:5
      at jsonParser (node_modules/body-parser/lib/types/json.js:100:7)
      at src/server.ts:165:34
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at internalNext (node_modules/helmet/index.cjs:531:6)
      at xXssProtectionMiddleware (node_modules/helmet/index.cjs:311:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPoweredByMiddleware (node_modules/helmet/index.cjs:304:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPermittedCrossDomainPoliciesMiddleware (node_modules/helmet/index.cjs:297:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xFrameOptionsMiddleware (node_modules/helmet/index.cjs:281:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDownloadOptionsMiddleware (node_modules/helmet/index.cjs:261:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDnsPrefetchControlMiddleware (node_modules/helmet/index.cjs:254:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xContentTypeOptionsMiddleware (node_modules/helmet/index.cjs:246:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at strictTransportSecurityMiddleware (node_modules/helmet/index.cjs:239:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at referrerPolicyMiddleware (node_modules/helmet/index.cjs:207:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at originAgentClusterMiddleware (node_modules/helmet/index.cjs:182:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginResourcePolicyMiddleware (node_modules/helmet/index.cjs:175:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginOpenerPolicyMiddleware (node_modules/helmet/index.cjs:159:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at contentSecurityPolicyMiddleware (node_modules/helmet/index.cjs:124:4)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at helmetMiddleware (node_modules/helmet/index.cjs:533:6)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    üîç AUTH DEBUG: Error name: JsonWebTokenError

    [0m [90m 115 |[39m   } [36mcatch[39m (error[33m:[39m any) {
     [90m 116 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Auth middleware error:'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 117 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Error name:'[39m[33m,[39m error[33m.[39mname)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 118 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Error message:'[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m 119 |[39m
     [90m 120 |[39m     [36mif[39m (error[33m.[39mname [33m===[39m [32m'JsonWebTokenError'[39m) {[0m

      at authMiddleware (src/middleware/merchantauth.ts:117:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:147:12)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at compression (node_modules/compression/index.js:243:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:68:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at src/server.ts:179:5
      at jsonParser (node_modules/body-parser/lib/types/json.js:100:7)
      at src/server.ts:165:34
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at internalNext (node_modules/helmet/index.cjs:531:6)
      at xXssProtectionMiddleware (node_modules/helmet/index.cjs:311:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPoweredByMiddleware (node_modules/helmet/index.cjs:304:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPermittedCrossDomainPoliciesMiddleware (node_modules/helmet/index.cjs:297:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xFrameOptionsMiddleware (node_modules/helmet/index.cjs:281:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDownloadOptionsMiddleware (node_modules/helmet/index.cjs:261:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDnsPrefetchControlMiddleware (node_modules/helmet/index.cjs:254:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xContentTypeOptionsMiddleware (node_modules/helmet/index.cjs:246:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at strictTransportSecurityMiddleware (node_modules/helmet/index.cjs:239:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at referrerPolicyMiddleware (node_modules/helmet/index.cjs:207:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at originAgentClusterMiddleware (node_modules/helmet/index.cjs:182:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginResourcePolicyMiddleware (node_modules/helmet/index.cjs:175:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginOpenerPolicyMiddleware (node_modules/helmet/index.cjs:159:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at contentSecurityPolicyMiddleware (node_modules/helmet/index.cjs:124:4)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at helmetMiddleware (node_modules/helmet/index.cjs:533:6)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    üîç AUTH DEBUG: Error message: jwt malformed

    [0m [90m 116 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Auth middleware error:'[39m[33m,[39m error)[33m;[39m
     [90m 117 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Error name:'[39m[33m,[39m error[33m.[39mname)[33m;[39m
    [31m[1m>[22m[39m[90m 118 |[39m     console[33m.[39merror([32m'üîç AUTH DEBUG: Error message:'[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 119 |[39m
     [90m 120 |[39m     [36mif[39m (error[33m.[39mname [33m===[39m [32m'JsonWebTokenError'[39m) {
     [90m 121 |[39m       console[33m.[39mlog([32m'üîç AUTH DEBUG: JWT verification failed'[39m)[33m;[39m[0m

      at authMiddleware (src/middleware/merchantauth.ts:118:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:147:12)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at compression (node_modules/compression/index.js:243:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:68:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at src/server.ts:179:5
      at jsonParser (node_modules/body-parser/lib/types/json.js:100:7)
      at src/server.ts:165:34
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at internalNext (node_modules/helmet/index.cjs:531:6)
      at xXssProtectionMiddleware (node_modules/helmet/index.cjs:311:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPoweredByMiddleware (node_modules/helmet/index.cjs:304:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPermittedCrossDomainPoliciesMiddleware (node_modules/helmet/index.cjs:297:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xFrameOptionsMiddleware (node_modules/helmet/index.cjs:281:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDownloadOptionsMiddleware (node_modules/helmet/index.cjs:261:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDnsPrefetchControlMiddleware (node_modules/helmet/index.cjs:254:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xContentTypeOptionsMiddleware (node_modules/helmet/index.cjs:246:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at strictTransportSecurityMiddleware (node_modules/helmet/index.cjs:239:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at referrerPolicyMiddleware (node_modules/helmet/index.cjs:207:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at originAgentClusterMiddleware (node_modules/helmet/index.cjs:182:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginResourcePolicyMiddleware (node_modules/helmet/index.cjs:175:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginOpenerPolicyMiddleware (node_modules/helmet/index.cjs:159:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at contentSecurityPolicyMiddleware (node_modules/helmet/index.cjs:124:4)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at helmetMiddleware (node_modules/helmet/index.cjs:533:6)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.log
    üîç AUTH DEBUG: JWT verification failed

      at authMiddleware (src/middleware/merchantauth.ts:121:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/milestones/milestone-5/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d9939e547764d1d968', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    üîç AUTH DEBUG: Request to /me

      at authMiddleware (src/middleware/merchantauth.ts:23:13)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d9939e547764d1d968'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d9939e547764d1d968')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîç AUTH DEBUG: Auth header exists: false

      at authMiddleware (src/middleware/merchantauth.ts:24:13)

  console.log
    üîç AUTH DEBUG: Token exists: false

      at authMiddleware (src/middleware/merchantauth.ts:25:13)

  console.log
    üîÑ [MILESTONE CLAIM] Starting claim for user 691c14d9939e547764d1d968, milestone 5

      at PartnerService.claimMilestoneReward (src/services/partnerService.ts:177:15)

  console.log
    üîç AUTH DEBUG: No token provided

      at authMiddleware (src/middleware/merchantauth.ts:32:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.error
    ‚ùå [MILESTONE CLAIM] Transaction failed, rolled back: Error: Milestone not yet achieved
        at PartnerService.claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:187:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:266:21)

    [0m [90m 246 |[39m       [90m// Rollback transaction on error[39m
     [90m 247 |[39m       [36mawait[39m session[33m.[39mabortTransaction()[33m;[39m
    [31m[1m>[22m[39m[90m 248 |[39m       console[33m.[39merror([32m`‚ùå [MILESTONE CLAIM] Transaction failed, rolled back:`[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 249 |[39m       [36mthrow[39m error[33m;[39m
     [90m 250 |[39m     } [36mfinally[39m {
     [90m 251 |[39m       session[33m.[39mendSession()[33m;[39m[0m

      at PartnerService.claimMilestoneReward (src/services/partnerService.ts:248:15)
      at claimMilestoneReward (src/controllers/partnerController.ts:266:21)

  console.error
    Error claiming milestone reward: Error: Milestone not yet achieved
        at PartnerService.claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:187:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:266:21)

    [0m [90m 282 |[39m     })[33m;[39m
     [90m 283 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 284 |[39m     console[33m.[39merror([32m'Error claiming milestone reward:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 285 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 286 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 287 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Failed to claim milestone reward'[39m[0m

      at claimMilestoneReward (src/controllers/partnerController.ts:284:13)

  console.log
    üîç AUTH DEBUG: Request to /me

      at authMiddleware (src/middleware/merchantauth.ts:23:13)

  console.log
    üîç AUTH DEBUG: Auth header exists: true

      at authMiddleware (src/middleware/merchantauth.ts:24:13)

  console.log
    üîç AUTH DEBUG: Token exists: true

      at authMiddleware (src/middleware/merchantauth.ts:25:13)

  console.log
    üîç AUTH DEBUG: Token preview: eyJhbGciOiJIUzI1NiIs...

      at authMiddleware (src/middleware/merchantauth.ts:28:15)

  console.log
    üîç AUTH DEBUG: Verifying token with merchant secret

      at authMiddleware (src/middleware/merchantauth.ts:44:13)

  console.log
    üîç AUTH DEBUG: Token decoded successfully

      at authMiddleware (src/middleware/merchantauth.ts:46:13)

  console.log
    üîç AUTH DEBUG: MerchantId: undefined

      at authMiddleware (src/middleware/merchantauth.ts:47:13)

  console.log
    üîç AUTH DEBUG: MerchantUserId: undefined

      at authMiddleware (src/middleware/merchantauth.ts:48:13)

  console.log
    üîç AUTH DEBUG: Role: undefined

      at authMiddleware (src/middleware/merchantauth.ts:49:13)

  console.log
    üîç AUTH DEBUG: Merchant found: false

      at authMiddleware (src/middleware/merchantauth.ts:53:13)

  console.log
    üîç AUTH DEBUG: Merchant not found for ID: undefined

      at authMiddleware (src/middleware/merchantauth.ts:56:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/jackpot/25000/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d9939e547764d1da04', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d9939e547764d1da04'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d9939e547764d1da04')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîÑ [JACKPOT CLAIM] Starting claim for user 691c14d9939e547764d1da04, spend amount ‚Çπ25000

      at PartnerService.claimJackpotReward (src/services/partnerService.ts:352:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.error
    ‚ùå [JACKPOT CLAIM] Transaction failed, rolled back: Error: Jackpot milestone not yet achieved
        at PartnerService.claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:362:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:457:21)

    [0m [90m 425 |[39m       [90m// Rollback transaction on error[39m
     [90m 426 |[39m       [36mawait[39m session[33m.[39mabortTransaction()[33m;[39m
    [31m[1m>[22m[39m[90m 427 |[39m       console[33m.[39merror([32m`‚ùå [JACKPOT CLAIM] Transaction failed, rolled back:`[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 428 |[39m       [36mthrow[39m error[33m;[39m
     [90m 429 |[39m     } [36mfinally[39m {
     [90m 430 |[39m       session[33m.[39mendSession()[33m;[39m[0m

      at PartnerService.claimJackpotReward (src/services/partnerService.ts:427:15)
      at claimJackpotReward (src/controllers/partnerController.ts:457:21)

  console.error
    Error claiming jackpot reward: Error: Jackpot milestone not yet achieved
        at PartnerService.claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:362:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:457:21)

    [0m [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 474 |[39m     console[33m.[39merror([32m'Error claiming jackpot reward:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 475 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 476 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 477 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Failed to claim jackpot reward'[39m[0m

      at claimJackpotReward (src/controllers/partnerController.ts:474:13)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/jackpot/50000/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d9939e547764d1da04', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d9939e547764d1da04'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d9939e547764d1da04')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîÑ [JACKPOT CLAIM] Starting claim for user 691c14d9939e547764d1da04, spend amount ‚Çπ50000

      at PartnerService.claimJackpotReward (src/services/partnerService.ts:352:15)

  console.error
    ‚ùå [JACKPOT CLAIM] Transaction failed, rolled back: Error: Jackpot milestone not yet achieved
        at PartnerService.claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:362:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:457:21)

    [0m [90m 425 |[39m       [90m// Rollback transaction on error[39m
     [90m 426 |[39m       [36mawait[39m session[33m.[39mabortTransaction()[33m;[39m
    [31m[1m>[22m[39m[90m 427 |[39m       console[33m.[39merror([32m`‚ùå [JACKPOT CLAIM] Transaction failed, rolled back:`[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 428 |[39m       [36mthrow[39m error[33m;[39m
     [90m 429 |[39m     } [36mfinally[39m {
     [90m 430 |[39m       session[33m.[39mendSession()[33m;[39m[0m

      at PartnerService.claimJackpotReward (src/services/partnerService.ts:427:15)
      at claimJackpotReward (src/controllers/partnerController.ts:457:21)

  console.error
    Error claiming jackpot reward: Error: Jackpot milestone not yet achieved
        at PartnerService.claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:362:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:457:21)

    [0m [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 474 |[39m     console[33m.[39merror([32m'Error claiming jackpot reward:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 475 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 476 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 477 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Failed to claim jackpot reward'[39m[0m

      at claimJackpotReward (src/controllers/partnerController.ts:474:13)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/jackpot/100000/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14d9939e547764d1da04', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14d9939e547764d1da04'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14d9939e547764d1da04')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîÑ [JACKPOT CLAIM] Starting claim for user 691c14d9939e547764d1da04, spend amount ‚Çπ100000

      at PartnerService.claimJackpotReward (src/services/partnerService.ts:352:15)

  console.error
    ‚ùå [JACKPOT CLAIM] Transaction failed, rolled back: Error: Jackpot milestone not yet achieved
        at PartnerService.claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:362:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:457:21)

    [0m [90m 425 |[39m       [90m// Rollback transaction on error[39m
     [90m 426 |[39m       [36mawait[39m session[33m.[39mabortTransaction()[33m;[39m
    [31m[1m>[22m[39m[90m 427 |[39m       console[33m.[39merror([32m`‚ùå [JACKPOT CLAIM] Transaction failed, rolled back:`[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 428 |[39m       [36mthrow[39m error[33m;[39m
     [90m 429 |[39m     } [36mfinally[39m {
     [90m 430 |[39m       session[33m.[39mendSession()[33m;[39m[0m

      at PartnerService.claimJackpotReward (src/services/partnerService.ts:427:15)
      at claimJackpotReward (src/controllers/partnerController.ts:457:21)

  console.error
    Error claiming jackpot reward: Error: Jackpot milestone not yet achieved
        at PartnerService.claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:362:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimJackpotReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:457:21)

    [0m [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 474 |[39m     console[33m.[39merror([32m'Error claiming jackpot reward:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 475 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 476 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 477 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Failed to claim jackpot reward'[39m[0m

      at claimJackpotReward (src/controllers/partnerController.ts:474:13)

  console.log
    üîç AUTH DEBUG: Request to /logout

      at authMiddleware (src/middleware/merchantauth.ts:23:13)

  console.log
    üîç AUTH DEBUG: Auth header exists: true

      at authMiddleware (src/middleware/merchantauth.ts:24:13)

  console.log
    üîç AUTH DEBUG: Token exists: true

      at authMiddleware (src/middleware/merchantauth.ts:25:13)

  console.log
    üîç AUTH DEBUG: Token preview: eyJhbGciOiJIUzI1NiIs...

      at authMiddleware (src/middleware/merchantauth.ts:28:15)

  console.log
    üîç AUTH DEBUG: Verifying token with merchant secret

      at authMiddleware (src/middleware/merchantauth.ts:44:13)

  console.log
    üîç AUTH DEBUG: Token decoded successfully

      at authMiddleware (src/middleware/merchantauth.ts:46:13)

  console.log
    üîç AUTH DEBUG: MerchantId: undefined

      at authMiddleware (src/middleware/merchantauth.ts:47:13)

  console.log
    üîç AUTH DEBUG: MerchantUserId: undefined

      at authMiddleware (src/middleware/merchantauth.ts:48:13)

  console.log
    üîç AUTH DEBUG: Role: undefined

      at authMiddleware (src/middleware/merchantauth.ts:49:13)

  console.log
    üîç AUTH DEBUG: Merchant found: false

      at authMiddleware (src/middleware/merchantauth.ts:53:13)

  console.log
    üîç AUTH DEBUG: Merchant not found for ID: undefined

      at authMiddleware (src/middleware/merchantauth.ts:56:15)

  console.log
    üîç AUTH DEBUG: Request to /logout

      at authMiddleware (src/middleware/merchantauth.ts:23:13)

  console.log
    üîç AUTH DEBUG: Auth header exists: false

      at authMiddleware (src/middleware/merchantauth.ts:24:13)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/invalid-type/update',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîç AUTH DEBUG: Token exists: false

      at authMiddleware (src/middleware/merchantauth.ts:25:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14da939e547764d1dac8', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    üîç AUTH DEBUG: No token provided

      at authMiddleware (src/middleware/merchantauth.ts:32:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14da939e547764d1dac8'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14da939e547764d1dac8')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/profile/update',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14db939e547764d1db47', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14db939e547764d1db47'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14db939e547764d1db47')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/review/update',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14db939e547764d1db47', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14db939e547764d1db47'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14db939e547764d1db47')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/referral/update',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14db939e547764d1db47', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14db939e547764d1db47'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14db939e547764d1db47')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/social/update',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14db939e547764d1db47', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14db939e547764d1db47'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14db939e547764d1db47')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/benefits',
      method: 'GET',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14dc939e547764d1dc1d', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14dc939e547764d1dc1d'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14dc939e547764d1dc1d')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/benefits',
      method: 'GET',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14dc939e547764d1dca3', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14dc939e547764d1dca3'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14dc939e547764d1dca3')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/milestones/milestone-5/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14dd939e547764d1dd21', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14dd939e547764d1dd21'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14dd939e547764d1dd21')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîÑ [MILESTONE CLAIM] Starting claim for user 691c14dd939e547764d1dd21, milestone 5

      at PartnerService.claimMilestoneReward (src/services/partnerService.ts:177:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.error
    ‚ùå [MILESTONE CLAIM] Transaction failed, rolled back: Error: Milestone not yet achieved
        at PartnerService.claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:187:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:266:21)

    [0m [90m 246 |[39m       [90m// Rollback transaction on error[39m
     [90m 247 |[39m       [36mawait[39m session[33m.[39mabortTransaction()[33m;[39m
    [31m[1m>[22m[39m[90m 248 |[39m       console[33m.[39merror([32m`‚ùå [MILESTONE CLAIM] Transaction failed, rolled back:`[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 249 |[39m       [36mthrow[39m error[33m;[39m
     [90m 250 |[39m     } [36mfinally[39m {
     [90m 251 |[39m       session[33m.[39mendSession()[33m;[39m[0m

      at PartnerService.claimMilestoneReward (src/services/partnerService.ts:248:15)
      at claimMilestoneReward (src/controllers/partnerController.ts:266:21)

  console.error
    Error claiming milestone reward: Error: Milestone not yet achieved
        at PartnerService.claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:187:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimMilestoneReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:266:21)

    [0m [90m 282 |[39m     })[33m;[39m
     [90m 283 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 284 |[39m     console[33m.[39merror([32m'Error claiming milestone reward:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 285 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 286 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 287 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Failed to claim milestone reward'[39m[0m

      at claimMilestoneReward (src/controllers/partnerController.ts:284:13)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/Complete%20Your%20Profile/claim',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14dd939e547764d1ddb2', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14dd939e547764d1ddb2'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14dd939e547764d1ddb2')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üîÑ [TASK CLAIM] Starting claim for user 691c14dd939e547764d1ddb2, task Complete Your Profile

      at PartnerService.claimTaskReward (src/services/partnerService.ts:264:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

  console.error
    ‚ùå [TASK CLAIM] Transaction failed, rolled back: Error: Task not yet completed
        at PartnerService.claimTaskReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:274:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimTaskReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:358:21)

    [0m [90m 334 |[39m       [90m// Rollback transaction on error[39m
     [90m 335 |[39m       [36mawait[39m session[33m.[39mabortTransaction()[33m;[39m
    [31m[1m>[22m[39m[90m 336 |[39m       console[33m.[39merror([32m`‚ùå [TASK CLAIM] Transaction failed, rolled back:`[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 337 |[39m       [36mthrow[39m error[33m;[39m
     [90m 338 |[39m     } [36mfinally[39m {
     [90m 339 |[39m       session[33m.[39mendSession()[33m;[39m[0m

      at PartnerService.claimTaskReward (src/services/partnerService.ts:336:15)
      at claimTaskReward (src/controllers/partnerController.ts:358:21)

  console.error
    Error claiming task reward: Error: Task not yet completed
        at PartnerService.claimTaskReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\services\partnerService.ts:274:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at claimTaskReward (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\controllers\partnerController.ts:358:21)

    [0m [90m 376 |[39m     })[33m;[39m
     [90m 377 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 378 |[39m     console[33m.[39merror([32m'Error claiming task reward:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 379 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 380 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 381 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Failed to claim task reward'[39m[0m

      at claimTaskReward (src/controllers/partnerController.ts:378:13)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

FAIL src/__tests__/merchantProducts.test.ts (164.855 s)
  Merchant Products
    POST /api/merchant/products
      √ó should create a new product (3589 ms)
      √ó should auto-generate SKU if not provided (1014 ms)
      √ó should reject duplicate SKU (777 ms)
      √ó should validate required fields (756 ms)
      √ó should require authentication (559 ms)
    GET /api/merchant/products
      √ó should get all merchant products (525 ms)
      √ó should filter by status (596 ms)
      √ó should filter by stock level (571 ms)
      √ó should support pagination (333 ms)
      √ó should sort products (863 ms)
    GET /api/merchant/products/:id
      √ó should get a single product by ID (368 ms)
      √ó should return 404 for non-existent product (1112 ms)
      √ó should not allow access to another merchant's product (321 ms)
    PUT /api/merchant/products/:id
      √ó should update product fields (707 ms)
      √ó should return 404 for non-existent product (397 ms)
    DELETE /api/merchant/products/:id
      √ó should delete a product (514 ms)
      √ó should return 404 for non-existent product (422 ms)

  ‚óè Merchant Products ‚Ä∫ POST /api/merchant/products ‚Ä∫ should create a new product

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ POST /api/merchant/products ‚Ä∫ should auto-generate SKU if not provided

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ POST /api/merchant/products ‚Ä∫ should reject duplicate SKU

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ POST /api/merchant/products ‚Ä∫ should validate required fields

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ POST /api/merchant/products ‚Ä∫ should require authentication

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products ‚Ä∫ should get all merchant products

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products ‚Ä∫ should filter by status

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products ‚Ä∫ should filter by stock level

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products ‚Ä∫ should support pagination

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products ‚Ä∫ should sort products

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products/:id ‚Ä∫ should get a single product by ID

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products/:id ‚Ä∫ should return 404 for non-existent product

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ GET /api/merchant/products/:id ‚Ä∫ should not allow access to another merchant's product

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ PUT /api/merchant/products/:id ‚Ä∫ should update product fields

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ PUT /api/merchant/products/:id ‚Ä∫ should return 404 for non-existent product

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ DELETE /api/merchant/products/:id ‚Ä∫ should delete a product

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  ‚óè Merchant Products ‚Ä∫ DELETE /api/merchant/products/:id ‚Ä∫ should return 404 for non-existent product

    ValidationError: Category validation failed: type: `product` is not a valid enum value for path `type`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3358:32)
      at node_modules/mongoose/lib/document.js:3119:17
      at node_modules/mongoose/lib/schemaType.js:1410:9

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

  console.log
    üîê [AUTH] Authenticating request: {
      path: '/tasks/profile/update',
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14de939e547764d1dec6', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14de939e547764d1dec6'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14de939e547764d1dec6')

      at authenticate (src/middleware/auth.ts:111:15)

  console.log
    üéÅ [OFFERS] Generated 2 offers for level 1

      at generateLevelOffers (src/models/Partner.ts:616:11)

FAIL src/__tests__/merchantAuth.test.ts (165.462 s)
  Merchant Authentication
    POST /api/merchant/auth/register
      ‚àö should register a new merchant (4285 ms)
      ‚àö should not register with duplicate email (1357 ms)
      ‚àö should validate required fields (481 ms)
      ‚àö should validate email format (446 ms)
      ‚àö should hash the password (883 ms)
    POST /api/merchant/auth/login
      √ó should login with valid credentials (1349 ms)
      ‚àö should not login with invalid password (561 ms)
      ‚àö should not login with non-existent email (375 ms)
      √ó should update lastLogin on successful login (955 ms)
    GET /api/merchant/auth/me
      √ó should return merchant profile with valid token (1032 ms)
      ‚àö should reject invalid token (594 ms)
      ‚àö should reject missing token (300 ms)
      √ó should not return password in response (612 ms)
    POST /api/merchant/auth/logout
      √ó should logout successfully with valid token (595 ms)
      ‚àö should reject logout without token (314 ms)
    GET /api/merchant/auth/test
      ‚àö should respond with success for connectivity test (321 ms)

  ‚óè Merchant Authentication ‚Ä∫ POST /api/merchant/auth/login ‚Ä∫ should login with valid credentials

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 142 |[39m         })[33m;[39m
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 145 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 146 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mtoken)[33m.[39mtoBeDefined()[33m;[39m
     [90m 147 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mmerchant[33m.[39memail)[33m.[39mtoBe(testEmail)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:144:31)

  ‚óè Merchant Authentication ‚Ä∫ POST /api/merchant/auth/login ‚Ä∫ should update lastLogin on successful login

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 196 |[39m         })[33m;[39m
     [90m 197 |[39m
    [31m[1m>[22m[39m[90m 198 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 199 |[39m
     [90m 200 |[39m       [36mconst[39m updatedMerchant [33m=[39m [36mawait[39m [33mMerchant[39m[33m.[39mfindById(merchant[33m.[39m_id)[33m;[39m
     [90m 201 |[39m       expect(updatedMerchant[33m![39m[33m.[39mlastLogin)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:198:31)

  ‚óè Merchant Authentication ‚Ä∫ GET /api/merchant/auth/me ‚Ä∫ should return merchant profile with valid token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 213 |[39m         [33m.[39m[36mset[39m(createAuthHeaders(token))[33m;[39m
     [90m 214 |[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 216 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 217 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mmerchant)[33m.[39mtoBeDefined()[33m;[39m
     [90m 218 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mmerchant[33m.[39memail)[33m.[39mtoBe(merchant[33m.[39memail)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:215:31)

  ‚óè Merchant Authentication ‚Ä∫ GET /api/merchant/auth/me ‚Ä∫ should not return password in response

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 245 |[39m         [33m.[39m[36mset[39m(createAuthHeaders(token))[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 248 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mmerchant[33m.[39mpassword)[33m.[39mtoBeUndefined()[33m;[39m
     [90m 249 |[39m     })[33m;[39m
     [90m 250 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:247:31)

  ‚óè Merchant Authentication ‚Ä∫ POST /api/merchant/auth/logout ‚Ä∫ should logout successfully with valid token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 259 |[39m         [33m.[39m[36mset[39m(createAuthHeaders(token))[33m;[39m
     [90m 260 |[39m
    [31m[1m>[22m[39m[90m 261 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 262 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 263 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'Logout successful'[39m)[33m;[39m
     [90m 264 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/merchantAuth.test.ts:261:31)

  console.log
    üîê [AUTH] Authenticating request: {
      path: "/milestones/milestone-1'%20OR%201=1--/claim",
      method: 'POST',
      hasToken: true,
      tokenPreview: 'eyJhbGciOiJIUzI1NiIs...'
    }

      at authenticate (src/middleware/auth.ts:56:13)

  console.log
    üîì [AUTH] Token decoded: { userId: '691c14df939e547764d1df4b', role: 'user' }

      at authenticate (src/middleware/auth.ts:73:15)

  console.log
    ‚úÖ [AUTH] User found: {
      id: new ObjectId('691c14df939e547764d1df4b'),
      phone: '+919876543210',
      isActive: true
    }

      at authenticate (src/middleware/auth.ts:85:15)

  console.log
    ‚úÖ [AUTH] Authentication successful for user: new ObjectId('691c14df939e547764d1df4b')

      at authenticate (src/middleware/auth.ts:111:15)

  console.error
    ‚ùå Test cleanup failed: MongooseError: Operation `transactions.deleteMany()` buffering timed out after 10000ms
        at Timeout.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\node_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
        at listOnTimeout (node:internal/timers:573:17)
        at processTimers (node:internal/timers:514:7)

    [0m [90m 26 |[39m     }
     [90m 27 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 28 |[39m     console[33m.[39merror([32m'‚ùå Test cleanup failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 29 |[39m   }
     [90m 30 |[39m })[33m;[39m
     [90m 31 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:28:13)

  console.error
    ‚ùå Test database disconnection failed: TypeError: Cannot read properties of undefined (reading 'stop')
        at Object.<anonymous> (C:\Users\Mukul raj\Downloads\rez-new\rez-app\user-backend\src\__tests__\setup.ts:36:23)

    [0m [90m 37 |[39m     console[33m.[39mlog([32m'‚úÖ Test database disconnected'[39m)[33m;[39m
     [90m 38 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 39 |[39m     console[33m.[39merror([32m'‚ùå Test database disconnection failed:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 40 |[39m   }
     [90m 41 |[39m })[33m;[39m
     [90m 42 |[39m[0m

      at Object.<anonymous> (src/__tests__/setup.ts:39:13)

FAIL src/__tests__/referralController.test.ts (167.301 s)
  Referral Controller
    getReferralCode
      √ó should return referral code for authenticated user (10045 ms)
      √ó should generate referral code if not exists (10029 ms)
      √ó should return 401 if user not authenticated (12384 ms)
      √ó should return 404 if user not found (10611 ms)
    shareReferralLink
      √ó should validate platform parameter (10019 ms)
      √ó should accept valid platforms (10037 ms)
      √ó should reject non-string platform (10084 ms)
    getReferralStats
      √ó should return stats for authenticated user (10022 ms)
    Security Tests
      √ó should not expose PII in logs (10114 ms)
      √ó should sanitize userId in logs (10034 ms)
    Referral Code Generation
      √ó should generate cryptographically secure referral codes (10086 ms)

  ‚óè Referral Controller ‚Ä∫ getReferralCode ‚Ä∫ should return referral code for authenticated user

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ getReferralCode ‚Ä∫ should generate referral code if not exists

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ getReferralCode ‚Ä∫ should return 401 if user not authenticated

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ getReferralCode ‚Ä∫ should return 404 if user not found

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ shareReferralLink ‚Ä∫ should validate platform parameter

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ shareReferralLink ‚Ä∫ should accept valid platforms

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ shareReferralLink ‚Ä∫ should reject non-string platform

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ getReferralStats ‚Ä∫ should return stats for authenticated user

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ Security Tests ‚Ä∫ should not expose PII in logs

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ Security Tests ‚Ä∫ should sanitize userId in logs

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  ‚óè Referral Controller ‚Ä∫ Referral Code Generation ‚Ä∫ should generate cryptographically secure referral codes

    Instance failed to start within 10000ms

      at Timeout.<anonymous> (node_modules/mongodb-memory-server-core/src/util/MongoInstance.ts:383:21)

  console.log
    ‚úÖ Test database disconnected

      at Object.<anonymous> (src/__tests__/setup.ts:37:13)

  console.log
    ‚úÖ Integration test database disconnected

      at Object.<anonymous> (src/__tests__/partnerAPI.test.ts:35:11)

PASS src/__tests__/partnerAPI.test.ts (171.066 s)
  Partner API - Authentication
    ‚àö should reject requests without auth token (3869 ms)
    ‚àö should accept requests with valid auth token (864 ms)
  Partner API - Dashboard
    ‚àö should return complete partner dashboard data (507 ms)
  Partner API - Input Validation
    ‚àö should reject invalid milestone ID format (833 ms)
    ‚àö should reject invalid jackpot amount (554 ms)
    ‚àö should accept valid milestone ID format (643 ms)
    ‚àö should accept valid jackpot amounts (882 ms)
    ‚àö should validate task type in update endpoint (498 ms)
    ‚àö should accept valid task types (940 ms)
  Partner API - Benefits Endpoint
    ‚àö should return all level benefits (651 ms)
    ‚àö should include benefit details for each level (463 ms)
  Partner API - Error Handling
    ‚àö should return appropriate error for claiming unachieved milestone (641 ms)
    ‚àö should return appropriate error for claiming unachieved task (550 ms)
    ‚àö should handle database errors gracefully (319 ms)
  Partner API - Security
    ‚àö should sanitize malicious input in request body (386 ms)
    ‚àö should prevent SQL injection attempts in parameters (354 ms)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 12 failed, 7 passed, 19 total
Tests:       70 failed, 73 passed, 143 total
Snapshots:   0 total
Time:        173.778 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
